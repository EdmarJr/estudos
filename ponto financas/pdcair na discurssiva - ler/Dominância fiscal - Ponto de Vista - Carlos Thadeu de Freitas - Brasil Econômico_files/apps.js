IBTX.Core.Obj.AbstractAppController=function($){"use strict";var strFormat=IBTX.Hlp.string.format,isFunction=IBTX.Core.check.isFunction,statik={},Obj;statik.getListExecWrapper=function(iterator,method,opts){return function(){statik.listExec(iterator,method,opts,Array.prototype.slice.call(arguments))}};statik.listExec=function(iterator,method,opts,args){var optCallback,callbackCnt;if(args.length&&isFunction(args[args.length-1])&&opts.optReturnsByCallback===true){callbackCnt=iterator.collection.length;optCallback=args.pop();args.push(function(){callbackCnt-=1;if(!callbackCnt){optCallback();setTimeout(opts.optCallback,0)}})}iterator.each(function(item){if(item["_"+method]&&args.length>item["_"+method].length){throw new Error("Invalid number of arguments calling method "+method+" (expected "+item["_"+method].length+", got "+args.length+")")}item[method].apply(item,args)})};Obj=function(appObj,appDef){var that=this;that.appDef=appDef;that.refs={};that.refId=100;that.appObj=appObj;that.selector=strFormat(".rt-##",appDef.appName);that.dataAttrRefId=strFormat("data-rt-##-ref-id",appDef.appName);return that};Obj.prototype=new IBTX.Core.Obj.EventEmitter;Obj.prototype.find=function(sel){var that=this,found=[],refIds=[],refId=0,iterator;$(sel||that.selector).each(function(){var $this=$(this),AppObj=that.appObj;if($this.hasClass(that.selector.substring(1))){if(!$this.attr(that.dataAttrRefId)){that.refId+=1;$this.attr(that.dataAttrRefId,that.refId);that.refs[that.refId]=new AppObj({appName:that.appDef.appName,optHooks:that.appDef.optHooks,optStartWhen:that.appDef.optStartWhen,optHTMLConfigs:that.appDef.optHTMLConfigs,optJqElm:$this});that.emit("new",that.refs[that.refId]);IBTX.emit("newAppInstance",that.appDef.appName,that.refs[that.refId])}found.push(that.refs[$this.attr(that.dataAttrRefId)]);refIds.push($this.attr(that.dataAttrRefId))}});iterator=new IBTX.Hlp.Obj.Iterator(found);iterator.setConfiguration=statik.getListExecWrapper(iterator,"setConfiguration");iterator.start=statik.getListExecWrapper(iterator,"start",{optReturnsByCallback:true});iterator.finish=statik.getListExecWrapper(iterator,"finish",{optReturnsByCallback:true,optCallback:function(){for(refId=0;refId<refIds.length;refId+=1){delete that.refs[refIds[refId]]}}});iterator.setHook=statik.getListExecWrapper(iterator,"setHook");return iterator};Obj.prototype.each=function(callback){var that=this;that.find().each(callback)};Obj.prototype.setConfiguration=function(){var that=this;statik.listExec(that.find(),"setConfiguration",{},Array.prototype.slice.call(arguments));return that};Obj.prototype.start=function(){var that=this;statik.listExec(that.find(),"start",{optReturnsByCallback:true},Array.prototype.slice.call(arguments));return that};Obj.prototype.finish=function(){var that=this;statik.listExec(that.find(),"finish",{optReturnsByCallback:true,optCallback:function(){that.refs={}}},Array.prototype.slice.call(arguments));return that};Obj.prototype.setHook=function(){var that=this;statik.listExec(that.find(),"setHook",{},Array.prototype.slice.call(arguments));return that};return Obj}(IBTX.jQuery);IBTX.Core.Obj.AbstractApp=function($){"use strict";var strFormat=IBTX.Hlp.string.format,isString=IBTX.Core.check.isString,isBoolean=IBTX.Core.check.isBoolean,Obj;Obj=function(props){var that=this,dataAttrCfgPrefix="",dataAttrLoad="";if(props){dataAttrCfgPrefix=strFormat("data-rt-##-",props.appName);dataAttrLoad=strFormat("data-rt-##-load",props.appName);props=props||{};that.name=props.appName;that.hooks=new IBTX.Core.Obj.HookManager(props.optHooks);that.startWhen=props.optJqElm.attr(dataAttrLoad)||props.optStartWhen||"inview";that.cfg=that.cfg||{};props.optHTMLConfigs=props.optHTMLConfigs||{};Object.keys(props.optHTMLConfigs).forEach(function(optHTMLConfig){if(props.optJqElm.attr(dataAttrCfgPrefix+optHTMLConfig)!==undefined){that.cfg[props.optHTMLConfigs[optHTMLConfig].name]=Obj.getConvertedByType(props.optJqElm.attr(dataAttrCfgPrefix+optHTMLConfig),props.optHTMLConfigs[optHTMLConfig].type)}});that.cfg.tpl=that.cfg.tpl||IBTX.App.view[props.appName];if(isString(that.cfg.tpl)){that.cfg.tpl={main:that.cfg.tpl}}else if(that.cfg.tpl&&!that.cfg.tpl.main){throw new Error("views (expressed as an object) should contain property main")}that.jq=props.optJqElm;that.htmlNode=props.optJqElm[0];that.store={};that.started=false;IBTX.whenStarted(function(){if(props.optStartWhen!=="ondemand"){that.start()}})}return that};Obj.prototype=new IBTX.Core.Obj.EventEmitter;Obj.prototype.setConfiguration=function(opts){var that=this,iCfg=that.cfg;Object.keys(opts).forEach(function(opt){if(opt==="tpl"){iCfg.tpl=iCfg.tpl||{};if(isString(opts.tpl)){iCfg.tpl.main=opts.tpl}else{Object.keys(opts[opt]).forEach(function(tplN){iCfg.tpl[tplN]=opts.tpl[tplN]})}}else{iCfg[opt]=opts[opt]}});if(that._setConfiguration){that.cfg={};that._setConfiguration(iCfg,opts)}return that};Obj.prototype.start=function(optCb){var that=this;if(!that._start){throw new Error("Unsupported Operation")}switch(that.startWhen){case"ondemand":case"auto":if(!that.started){that.started=true;that._start(optCb)}break;default:that.jq.one("inview",function(e,visible,p){if(visible){if(!that.started){that.started=true;that._start(optCb)}}});break}return that};Obj.prototype.finish=function(optCb){var that=this;if(!that._finish){throw new Error("Unsupported Operation")}that.jq.off("inview");if(that.started){that.started=false;that._finish(optCb)}return that};Obj.prototype.setHook=function(hook,callback){var that=this;that.hooks.set(hook,callback);return that};Obj.prototype.compileRenderJq=function(target,data){var that=this,node=target,search="";if(isString(target)){node=$(IBTX.thirdParty.Handlebars.compile(target)(data))}else if(target instanceof $){Object.keys(data).forEach(function(datum){search=strFormat("[data-rt-{app}-{attr}]",{app:that.name,attr:datum});target.findAll(search).each(function(){$(this).attr(search.slice(1,-1),data[datum])});search=strFormat(".rt-{app}-{attr}",{app:that.name,attr:datum});target.findAll(search).each(function(){$(this).html(data[datum])})})}return node};Obj.prototype.compileRenderView=function(target,data,templateId){var that=this,view=target,contrProps={},viewProps={},Ember=IBTX.thirdParty.Ember,templateName=that.name+"-"+templateId;if(isString(target)){Object.keys(data).forEach(function(datum){contrProps[datum]=data[datum]});viewProps={tagName:"ember",templateName:templateName,controller:Ember.Object.create(contrProps)};Object.keys(data).forEach(function(datum){viewProps[datum]=data[datum]});$("body").append(strFormat('<script type="text/x-handlebars" data-template-name="{templateName}">{template}</script>',{templateName:templateName,template:target}));Ember.Application.create();view=Ember.View.create(viewProps)}else if(target instanceof Ember.View){Object.keys(data).forEach(function(datum){view.controller.set(datum,data[datum])})}view.getJq=function(callback){setTimeout(function(){callback($("#"+view.elementId).children())},0)};return view};Obj.prototype.storeGet=function(optId){var that=this,recIdx=0,got,isRec=isString(optId);if(isRec){for(recIdx=0;recIdx<(that.store._records||[]).length;recIdx+=1){if(that.store._records[recIdx]._id===optId){got=that.store._records[recIdx];break}}}else{got=that.store}return got};Obj.prototype.storeSet=function(optId,obj){var that=this,recIdx=0,record,found=false,isRec=isString(optId),res={},iOptId=optId,iObj=obj;if(!isRec){iObj=optId}function getUpdatedTargetMeta(src,obj){var meta={};if(!src._meta){meta={createdAt:new Date,updatedAt:new Date,isPreload:true,isCreate:true,isUpdate:false}}else{meta={createdAt:src._meta.createdAt,updatedAt:src._meta.updatedAt||new Date,isPreload:isBoolean(obj._meta&&obj._meta.isPreload)?obj._meta.isPreload:false,isCreate:isBoolean(obj._meta&&obj._meta.isCreate)?obj._meta.isCreate:false,isUpdate:isBoolean(obj._meta&&obj._meta.isUpdate)?obj._meta.isUpdate:true}}Object.keys(obj._meta||{}).forEach(function(key){meta[key]=obj._meta[key]});return meta}function getUpdatedTargetData(src,obj){var data={};if(!src._data){data={}}Object.keys(obj._data).forEach(function(key){data[key]=obj._data[key]});return data}if(isRec){that.store._records=that.store._records||[];for(recIdx=0;recIdx<that.store._records.length;recIdx+=1){if(that.store._records[recIdx]._id===iOptId){found=true;break}}record=found?that.store._records[recIdx]:{};record._meta=getUpdatedTargetMeta(record,iObj);record._data=getUpdatedTargetData(record,iObj);record._id=iOptId;if(!found){that.store._records.push(record)}else{that.store._records[recIdx]=record}that.store._meta=getUpdatedTargetMeta(that.store,{});res=record}else{that.store._meta=getUpdatedTargetMeta(that.store,iObj);if(iObj._data){that.store._data=getUpdatedTargetData(that.store,iObj)}res=that.store}};Obj.prototype.storeDel=function(id){var that=this,recIdx=0;for(recIdx=0;recIdx<(that.store._records||[]).length;recIdx+=1){if(that.store._records[recIdx]._id===id){that.store._records.splice(recIdx,1);break}}};Obj.prototype.storeGetJq=function(optId){var that=this;return(that.storeGet(optId)||{})._jq};Obj.prototype.storeSetJq=function(optId,jq){var that=this;if(!isString(optId)){jq=optId;optId=undefined}that.storeGet(optId)._jq=jq};Obj.prototype.storeGetEView=function(optId){var that=this;return(that.storeGet(optId)||{})._eview};Obj.prototype.storeSetEView=function(optId,eview){var that=this;if(!isString(optId)){eview=optId;optId=undefined}that.storeGet(optId)._eview=eview};Obj.prototype.storeGetMeta=function(optId){var that=this;return(that.storeGet(optId)||{})._meta};Obj.prototype.storeSetMeta=function(optId,meta){var that=this;if(!isString(optId)){meta=optId;optId=undefined}that.storeGet(optId)._meta=meta};Obj.prototype.storeGetData=function(optId){var that=this;return(that.storeGet(optId)||{})._data};Obj.prototype.storeSetData=function(optId,data){var that=this;if(!isString(optId)){data=optId;optId=undefined}that.storeGet(optId)._data=data};Obj.getConvertedByType=function(variable,type){var converted=variable,subType=type;if(subType==="number"){if(variable.indexOf(".")>=0){subType="integer"}else{subType="float"}}switch(subType){case"boolean":if(variable==="false"){converted=false}else if(variable==="true"){converted=true}break;case"integer":converted=parseInt(variable,10);break;case"float":converted=parseFloat(variable);break}return converted};return Obj}(IBTX.jQuery);IBTX.Hlp.Obj.DomCreateListener=function($){"use strict";var statik={},konst={},Obj;konst.TIMEOUT_CHECK=1e3;statik.data={nextRefId:0};statik.supportsCssFrames=false;statik.preloaded=false;Obj=function(selector,callback){var that=this;if(!selector){throw new Error("You need to pass a valid CSS3 selector")}if(!callback){throw new Error("You need to pass a valid callback")}that.selector=selector;that.refId=statik.data.nextRefId;statik.data.nextRefId+=1;that.callback=callback;that.animationName="nodeInserted"+that.refId;that.detectNewItems()};Obj.prototype.detectNewItems=function(){var that=this;if(statik.supportsCssFrames){that.addCssListener();return}$(that.selector).each(function(){var dataName="domCreateListenerDetected";if(!$(this).data(dataName)){if(statik.preloaded){that.callback($(this).get(0))}$(this).data(dataName,true)}});statik.preloaded=true;setTimeout(that.detectNewItems.bind(that),konst.TIMEOUT_CHECK)};Obj.prototype.addCssListener=function(){var that=this,insertListener;insertListener=function(event){if(event.animationName===that.animationName){that.callback(event.target)}};if(document.addEventListener){that.addStyles();document.addEventListener("animationstart",insertListener,false);document.addEventListener("MSAnimationStart",insertListener,false);document.addEventListener("webkitAnimationStart",insertListener,false)}};Obj.prototype.addStyles=function(){var that=this,styleElement=document.getElementById("domCreateListener"),animationName=that.animationName;if(!styleElement){styleElement=document.createElement("style");styleElement.id="domCreateListener";styleElement.type="text/css";document.head.appendChild(styleElement)}$(styleElement).append(" "+"@keyframes "+animationName+" {from { opacity: .9 } to { opacity: 1; }}"+"@-moz-keyframes "+animationName+" {from { opacity: .9 } to { opacity: 1; }}"+"@-webkit-keyframes "+animationName+" {from { opacity: .9 } to { opacity: 1; }}"+"@-ms-keyframes "+animationName+" {from { opacity: .9 } to { opacity: 1; }}"+"@-o-keyframes "+animationName+" {from { opacity: .9 } to { opacity: 1; }}"+that.selector+" {"+"    animation-duration: 0.001s;"+"    -o-animation-duration: 0.001s;"+"    -ms-animation-duration: 0.001s;"+"    -moz-animation-duration: 0.001s;"+"    -webkit-animation-duration: 0.001s;"+"    animation-name: "+animationName+";"+"    -o-animation-name: "+animationName+";"+"    -ms-animation-name: "+animationName+";"+"    -moz-animation-name: "+animationName+";"+"    -webkit-animation-name: "+animationName+";"+"}")};(function(){statik.supportsCssFrames=true;var t=new Obj("#testDomCreateListener",function(elm){statik.supportsCssFrames=true;elm.parentNode.removeChild(elm)});statik.supportsCssFrames=false;(function appendToBody(){var tag;if(document.body){tag=document.createElement("div");tag.id="testDomCreateListener";document.body.appendChild(tag)}else{setTimeout(appendToBody,250)}})()})();return Obj}(IBTX.jQuery);IBTX.Mod.rtIcon=function($){"use strict";var priv,pub;priv={data:{cssSelectors:{icon:".rt-icon, #rt-icon",status:".rt-icon-status, #rt-icon-status"},cssClasses:["connecting","connected","disconnected","reconnected","reconnecting"]},init:function(){var classes=priv.data.cssClasses,i=classes.length-1;pub=IBTX.Core.merge(pub,IBTX.Core.create(IBTX.Core.Obj.EventEmitter));IBTX.Mod.realtime.whenConnected(priv.bindClass("connected"));while(i>=0){IBTX.Mod.realtime.on(classes[i],priv.bindClass(classes[i]));i-=1}return pub},bindClass:function(classi){return function(){if(priv.data.cssClasses.indexOf(classi)>-1){$(priv.data.cssSelectors.icon).each(function(){var clIdx;for(clIdx=0;clIdx<priv.data.cssClasses.length;clIdx+=1){if(priv.data.cssClasses[clIdx]!==classi){$(this).removeClass(priv.data.cssClasses[clIdx])}}$(this).addClass(classi)});$(priv.data.cssSelectors.status).each(function(){$(this).html(classi)})}}}};pub={};return priv.init()}(IBTX.jQuery);(function(){var Handlebars={};(function(Handlebars,undefined){Handlebars.VERSION="1.0.0";Handlebars.COMPILER_REVISION=4;Handlebars.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"};Handlebars.helpers={};Handlebars.partials={};var toString=Object.prototype.toString,functionType="[object Function]",objectType="[object Object]";Handlebars.registerHelper=function(name,fn,inverse){if(toString.call(name)===objectType){if(inverse||fn){throw new Handlebars.Exception("Arg not supported with multiple helpers")}Handlebars.Utils.extend(this.helpers,name)}else{if(inverse){fn.not=inverse}this.helpers[name]=fn}};Handlebars.registerPartial=function(name,str){if(toString.call(name)===objectType){Handlebars.Utils.extend(this.partials,name)}else{this.partials[name]=str}};Handlebars.registerHelper("helperMissing",function(arg){if(arguments.length===2){return undefined}else{throw new Error("Missing helper: '"+arg+"'")}});Handlebars.registerHelper("blockHelperMissing",function(context,options){var inverse=options.inverse||function(){},fn=options.fn;var type=toString.call(context);if(type===functionType){context=context.call(this)}if(context===true){return fn(this)}else if(context===false||context==null){return inverse(this)}else if(type==="[object Array]"){if(context.length>0){return Handlebars.helpers.each(context,options)}else{return inverse(this)}}else{return fn(context)}});Handlebars.K=function(){};Handlebars.createFrame=Object.create||function(object){Handlebars.K.prototype=object;var obj=new Handlebars.K;Handlebars.K.prototype=null;return obj};Handlebars.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,methodMap:{0:"debug",1:"info",2:"warn",3:"error"},log:function(level,obj){if(Handlebars.logger.level<=level){var method=Handlebars.logger.methodMap[level];if(typeof console!=="undefined"&&console[method]){console[method].call(console,obj)}}}};Handlebars.log=function(level,obj){Handlebars.logger.log(level,obj)};Handlebars.registerHelper("each",function(context,options){var fn=options.fn,inverse=options.inverse;var i=0,ret="",data;var type=toString.call(context);if(type===functionType){context=context.call(this)}if(options.data){data=Handlebars.createFrame(options.data)}if(context&&typeof context==="object"){if(context instanceof Array){for(var j=context.length;i<j;i++){if(data){data.index=i}ret=ret+fn(context[i],{data:data})}}else{for(var key in context){if(context.hasOwnProperty(key)){if(data){data.key=key}ret=ret+fn(context[key],{data:data});i++}}}}if(i===0){ret=inverse(this)}return ret});Handlebars.registerHelper("if",function(conditional,options){var type=toString.call(conditional);if(type===functionType){conditional=conditional.call(this)}if(!conditional||Handlebars.Utils.isEmpty(conditional)){return options.inverse(this)}else{return options.fn(this)}});Handlebars.registerHelper("unless",function(conditional,options){return Handlebars.helpers["if"].call(this,conditional,{fn:options.inverse,inverse:options.fn})});Handlebars.registerHelper("with",function(context,options){var type=toString.call(context);if(type===functionType){context=context.call(this)}if(!Handlebars.Utils.isEmpty(context))return options.fn(context)});Handlebars.registerHelper("log",function(context,options){var level=options.data&&options.data.level!=null?parseInt(options.data.level,10):1;Handlebars.log(level,context)});var handlebars=function(){var parser={trace:function trace(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,simpleInverse:6,statements:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,CLOSE_UNESCAPED:24,OPEN_PARTIAL:25,partialName:26,params:27,hash:28,dataName:29,param:30,STRING:31,INTEGER:32,BOOLEAN:33,hashSegments:34,hashSegment:35,ID:36,EQUALS:37,DATA:38,pathSegments:39,SEP:40,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"CLOSE_UNESCAPED",25:"OPEN_PARTIAL",31:"STRING",32:"INTEGER",33:"BOOLEAN",36:"ID",37:"EQUALS",38:"DATA",40:"SEP"},productions_:[0,[3,2],[4,2],[4,3],[4,2],[4,1],[4,1],[4,0],[7,1],[7,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[6,2],[17,3],[17,2],[17,2],[17,1],[17,1],[27,2],[27,1],[30,1],[30,1],[30,1],[30,1],[30,1],[28,1],[34,2],[34,1],[35,3],[35,3],[35,3],[35,3],[35,3],[26,1],[26,1],[26,1],[29,2],[21,1],[39,3],[39,1]],performAction:function anonymous(yytext,yyleng,yylineno,yy,yystate,$$,_$){var $0=$$.length-1;switch(yystate){case 1:return $$[$0-1];break;case 2:this.$=new yy.ProgramNode([],$$[$0]);break;case 3:this.$=new yy.ProgramNode($$[$0-2],$$[$0]);break;case 4:this.$=new yy.ProgramNode($$[$0-1],[]);break;case 5:this.$=new yy.ProgramNode($$[$0]);break;case 6:this.$=new yy.ProgramNode([],[]);break;case 7:this.$=new yy.ProgramNode([]);break;case 8:this.$=[$$[$0]];break;case 9:$$[$0-1].push($$[$0]);this.$=$$[$0-1];break;case 10:this.$=new yy.BlockNode($$[$0-2],$$[$0-1].inverse,$$[$0-1],$$[$0]);break;case 11:this.$=new yy.BlockNode($$[$0-2],$$[$0-1],$$[$0-1].inverse,$$[$0]);break;case 12:this.$=$$[$0];break;case 13:this.$=$$[$0];break;case 14:this.$=new yy.ContentNode($$[$0]);break;case 15:this.$=new yy.CommentNode($$[$0]);break;case 16:this.$=new yy.MustacheNode($$[$0-1][0],$$[$0-1][1]);break;case 17:this.$=new yy.MustacheNode($$[$0-1][0],$$[$0-1][1]);break;case 18:this.$=$$[$0-1];break;case 19:this.$=new yy.MustacheNode($$[$0-1][0],$$[$0-1][1],$$[$0-2][2]==="&");break;case 20:this.$=new yy.MustacheNode($$[$0-1][0],$$[$0-1][1],true);break;case 21:this.$=new yy.PartialNode($$[$0-1]);break;case 22:this.$=new yy.PartialNode($$[$0-2],$$[$0-1]);break;case 23:break;case 24:this.$=[[$$[$0-2]].concat($$[$0-1]),$$[$0]];break;case 25:this.$=[[$$[$0-1]].concat($$[$0]),null];break;case 26:this.$=[[$$[$0-1]],$$[$0]];break;case 27:this.$=[[$$[$0]],null];break;case 28:this.$=[[$$[$0]],null];break;case 29:$$[$0-1].push($$[$0]);this.$=$$[$0-1];break;case 30:this.$=[$$[$0]];break;case 31:this.$=$$[$0];break;case 32:this.$=new yy.StringNode($$[$0]);break;case 33:this.$=new yy.IntegerNode($$[$0]);break;case 34:this.$=new yy.BooleanNode($$[$0]);break;case 35:this.$=$$[$0];break;case 36:this.$=new yy.HashNode($$[$0]);break;case 37:$$[$0-1].push($$[$0]);this.$=$$[$0-1];break;case 38:this.$=[$$[$0]];break;case 39:this.$=[$$[$0-2],$$[$0]];break;case 40:this.$=[$$[$0-2],new yy.StringNode($$[$0])];break;case 41:this.$=[$$[$0-2],new yy.IntegerNode($$[$0])];break;case 42:this.$=[$$[$0-2],new yy.BooleanNode($$[$0])];break;case 43:this.$=[$$[$0-2],$$[$0]];break;case 44:this.$=new yy.PartialNameNode($$[$0]);break;case 45:this.$=new yy.PartialNameNode(new yy.StringNode($$[$0]));break;case 46:this.$=new yy.PartialNameNode(new yy.IntegerNode($$[$0]));break;case 47:this.$=new yy.DataNode($$[$0]);break;case 48:this.$=new yy.IdNode($$[$0]);break;case 49:$$[$0-2].push({part:$$[$0],separator:$$[$0-1]});this.$=$$[$0-2];break;case 50:this.$=[{part:$$[$0]}];break}},table:[{3:1,4:2,5:[2,7],6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],22:[1,14],23:[1,15],25:[1,16]},{1:[3]},{5:[1,17]},{5:[2,6],7:18,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,6],22:[1,14],23:[1,15],25:[1,16]},{5:[2,5],6:20,8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,5],22:[1,14],23:[1,15],25:[1,16]},{17:23,18:[1,22],21:24,29:25,36:[1,28],38:[1,27],39:26},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],25:[2,8]},{4:29,6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,7],22:[1,14],23:[1,15],25:[1,16]},{4:30,6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,7],22:[1,14],23:[1,15],25:[1,16]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],25:[2,12]},{5:[2,13],14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],25:[2,13]},{5:[2,14],14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],25:[2,14]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],25:[2,15]},{17:31,21:24,29:25,36:[1,28],38:[1,27],39:26},{17:32,21:24,29:25,36:[1,28],38:[1,27],39:26},{17:33,21:24,29:25,36:[1,28],38:[1,27],39:26},{21:35,26:34,31:[1,36],32:[1,37],36:[1,28],39:26},{1:[2,1]},{5:[2,2],8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,2],22:[1,14],23:[1,15],25:[1,16]},{17:23,21:24,29:25,36:[1,28],38:[1,27],39:26},{5:[2,4],7:38,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,4],22:[1,14],23:[1,15],25:[1,16]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],25:[2,9]},{5:[2,23],14:[2,23],15:[2,23],16:[2,23],19:[2,23],20:[2,23],22:[2,23],23:[2,23],25:[2,23]},{18:[1,39]},{18:[2,27],21:44,24:[2,27],27:40,28:41,29:48,30:42,31:[1,45],32:[1,46],33:[1,47],34:43,35:49,36:[1,50],38:[1,27],39:26},{18:[2,28],24:[2,28]},{18:[2,48],24:[2,48],31:[2,48],32:[2,48],33:[2,48],36:[2,48],38:[2,48],40:[1,51]},{21:52,36:[1,28],39:26},{18:[2,50],24:[2,50],31:[2,50],32:[2,50],33:[2,50],36:[2,50],38:[2,50],40:[2,50]},{10:53,20:[1,54]},{10:55,20:[1,54]},{18:[1,56]},{18:[1,57]},{24:[1,58]},{18:[1,59],21:60,36:[1,28],39:26},{18:[2,44],36:[2,44]},{18:[2,45],36:[2,45]},{18:[2,46],36:[2,46]},{5:[2,3],8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,3],22:[1,14],23:[1,15],25:[1,16]},{14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],25:[2,17]},{18:[2,25],21:44,24:[2,25],28:61,29:48,30:62,31:[1,45],32:[1,46],33:[1,47],34:43,35:49,36:[1,50],38:[1,27],39:26},{18:[2,26],24:[2,26]},{18:[2,30],24:[2,30],31:[2,30],32:[2,30],33:[2,30],36:[2,30],38:[2,30]},{18:[2,36],24:[2,36],35:63,36:[1,64]},{18:[2,31],24:[2,31],31:[2,31],32:[2,31],33:[2,31],36:[2,31],38:[2,31]},{18:[2,32],24:[2,32],31:[2,32],32:[2,32],33:[2,32],36:[2,32],38:[2,32]},{18:[2,33],24:[2,33],31:[2,33],32:[2,33],33:[2,33],36:[2,33],38:[2,33]},{18:[2,34],24:[2,34],31:[2,34],32:[2,34],33:[2,34],36:[2,34],38:[2,34]},{18:[2,35],24:[2,35],31:[2,35],32:[2,35],33:[2,35],36:[2,35],38:[2,35]},{18:[2,38],24:[2,38],36:[2,38]},{18:[2,50],24:[2,50],31:[2,50],32:[2,50],33:[2,50],36:[2,50],37:[1,65],38:[2,50],40:[2,50]},{36:[1,66]},{18:[2,47],24:[2,47],31:[2,47],32:[2,47],33:[2,47],36:[2,47],38:[2,47]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],25:[2,10]},{21:67,36:[1,28],39:26},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],25:[2,11]},{14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],25:[2,16]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],25:[2,19]},{5:[2,20],14:[2,20],15:[2,20],16:[2,20],19:[2,20],20:[2,20],22:[2,20],23:[2,20],25:[2,20]},{5:[2,21],14:[2,21],15:[2,21],16:[2,21],19:[2,21],20:[2,21],22:[2,21],23:[2,21],25:[2,21]},{18:[1,68]},{18:[2,24],24:[2,24]},{18:[2,29],24:[2,29],31:[2,29],32:[2,29],33:[2,29],36:[2,29],38:[2,29]},{18:[2,37],24:[2,37],36:[2,37]},{37:[1,65]},{21:69,29:73,31:[1,70],32:[1,71],33:[1,72],36:[1,28],38:[1,27],39:26},{18:[2,49],24:[2,49],31:[2,49],32:[2,49],33:[2,49],36:[2,49],38:[2,49],40:[2,49]},{18:[1,74]},{5:[2,22],14:[2,22],15:[2,22],16:[2,22],19:[2,22],20:[2,22],22:[2,22],23:[2,22],25:[2,22]},{18:[2,39],24:[2,39],36:[2,39]},{18:[2,40],24:[2,40],36:[2,40]},{18:[2,41],24:[2,41],36:[2,41]},{18:[2,42],24:[2,42],36:[2,42]},{18:[2,43],24:[2,43],36:[2,43]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],25:[2,18]}],defaultActions:{17:[2,1]},parseError:function parseError(str,hash){throw new Error(str)},parse:function parse(input){var self=this,stack=[0],vstack=[null],lstack=[],table=this.table,yytext="",yylineno=0,yyleng=0,recovering=0,TERROR=2,EOF=1;this.lexer.setInput(input);this.lexer.yy=this.yy;this.yy.lexer=this.lexer;this.yy.parser=this;if(typeof this.lexer.yylloc=="undefined")this.lexer.yylloc={};var yyloc=this.lexer.yylloc;lstack.push(yyloc);var ranges=this.lexer.options&&this.lexer.options.ranges;if(typeof this.yy.parseError==="function")this.parseError=this.yy.parseError;function popStack(n){stack.length=stack.length-2*n;vstack.length=vstack.length-n;lstack.length=lstack.length-n}function lex(){var token;token=self.lexer.lex()||1;if(typeof token!=="number"){token=self.symbols_[token]||token}return token}var symbol,preErrorSymbol,state,action,a,r,yyval={},p,len,newState,expected;while(true){state=stack[stack.length-1];if(this.defaultActions[state]){action=this.defaultActions[state]}else{if(symbol===null||typeof symbol=="undefined"){symbol=lex()}action=table[state]&&table[state][symbol]}if(typeof action==="undefined"||!action.length||!action[0]){var errStr="";if(!recovering){expected=[];for(p in table[state])if(this.terminals_[p]&&p>2){expected.push("'"+this.terminals_[p]+"'")}if(this.lexer.showPosition){errStr="Parse error on line "+(yylineno+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+expected.join(", ")+", got '"+(this.terminals_[symbol]||symbol)+"'"}else{errStr="Parse error on line "+(yylineno+1)+": Unexpected "+(symbol==1?"end of input":"'"+(this.terminals_[symbol]||symbol)+"'")}this.parseError(errStr,{text:this.lexer.match,token:this.terminals_[symbol]||symbol,line:this.lexer.yylineno,loc:yyloc,expected:expected})}}if(action[0]instanceof Array&&action.length>1){throw new Error("Parse Error: multiple actions possible at state: "+state+", token: "+symbol)}switch(action[0]){case 1:stack.push(symbol);vstack.push(this.lexer.yytext);lstack.push(this.lexer.yylloc);stack.push(action[1]);symbol=null;if(!preErrorSymbol){yyleng=this.lexer.yyleng;yytext=this.lexer.yytext;yylineno=this.lexer.yylineno;yyloc=this.lexer.yylloc;if(recovering>0)recovering--}else{symbol=preErrorSymbol;preErrorSymbol=null}break;case 2:len=this.productions_[action[1]][1];yyval.$=vstack[vstack.length-len];yyval._$={first_line:lstack[lstack.length-(len||1)].first_line,last_line:lstack[lstack.length-1].last_line,first_column:lstack[lstack.length-(len||1)].first_column,last_column:lstack[lstack.length-1].last_column};if(ranges){yyval._$.range=[lstack[lstack.length-(len||1)].range[0],lstack[lstack.length-1].range[1]]}r=this.performAction.call(yyval,yytext,yyleng,yylineno,this.yy,action[1],vstack,lstack);if(typeof r!=="undefined"){return r}if(len){stack=stack.slice(0,-1*len*2);vstack=vstack.slice(0,-1*len);lstack=lstack.slice(0,-1*len)}stack.push(this.productions_[action[1]][0]);vstack.push(yyval.$);lstack.push(yyval._$);newState=table[stack[stack.length-2]][stack[stack.length-1]];stack.push(newState);break;case 3:return true}}return true}};var lexer=function(){var lexer={EOF:1,parseError:function parseError(str,hash){if(this.yy.parser){this.yy.parser.parseError(str,hash)}else{throw new Error(str)}},setInput:function(input){this._input=input;this._more=this._less=this.done=false;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};if(this.options.ranges)this.yylloc.range=[0,0];this.offset=0;return this},input:function(){var ch=this._input[0];this.yytext+=ch;this.yyleng++;this.offset++;this.match+=ch;this.matched+=ch;var lines=ch.match(/(?:\r\n?|\n).*/g);if(lines){this.yylineno++;this.yylloc.last_line++}else{this.yylloc.last_column++}if(this.options.ranges)this.yylloc.range[1]++;this._input=this._input.slice(1);return ch},unput:function(ch){var len=ch.length;var lines=ch.split(/(?:\r\n?|\n)/g);this._input=ch+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-len-1);this.offset-=len;var oldLines=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);if(lines.length-1)this.yylineno-=lines.length-1;var r=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:lines?(lines.length===oldLines.length?this.yylloc.first_column:0)+oldLines[oldLines.length-lines.length].length-lines[0].length:this.yylloc.first_column-len};if(this.options.ranges){this.yylloc.range=[r[0],r[0]+this.yyleng-len]}return this},more:function(){this._more=true;return this},less:function(n){this.unput(this.match.slice(n))},pastInput:function(){var past=this.matched.substr(0,this.matched.length-this.match.length);return(past.length>20?"...":"")+past.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var next=this.match;if(next.length<20){next+=this._input.substr(0,20-next.length)}return(next.substr(0,20)+(next.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var pre=this.pastInput();var c=new Array(pre.length+1).join("-");return pre+this.upcomingInput()+"\n"+c+"^"},next:function(){if(this.done){return this.EOF}if(!this._input)this.done=true;var token,match,tempMatch,index,col,lines;if(!this._more){this.yytext="";this.match=""}var rules=this._currentRules();for(var i=0;i<rules.length;i++){tempMatch=this._input.match(this.rules[rules[i]]);if(tempMatch&&(!match||tempMatch[0].length>match[0].length)){match=tempMatch;index=i;if(!this.options.flex)break}}if(match){lines=match[0].match(/(?:\r\n?|\n).*/g);if(lines)this.yylineno+=lines.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:lines?lines[lines.length-1].length-lines[lines.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+match[0].length};this.yytext+=match[0];this.match+=match[0];this.matches=match;this.yyleng=this.yytext.length;if(this.options.ranges){this.yylloc.range=[this.offset,this.offset+=this.yyleng]}this._more=false;this._input=this._input.slice(match[0].length);this.matched+=match[0];
token=this.performAction.call(this,this.yy,this,rules[index],this.conditionStack[this.conditionStack.length-1]);if(this.done&&this._input)this.done=false;if(token)return token;else return}if(this._input===""){return this.EOF}else{return this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})}},lex:function lex(){var r=this.next();if(typeof r!=="undefined"){return r}else{return this.lex()}},begin:function begin(condition){this.conditionStack.push(condition)},popState:function popState(){return this.conditionStack.pop()},_currentRules:function _currentRules(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function begin(condition){this.begin(condition)}};lexer.options={};lexer.performAction=function anonymous(yy,yy_,$avoiding_name_collisions,YY_START){var YYSTATE=YY_START;switch($avoiding_name_collisions){case 0:yy_.yytext="\\";return 14;break;case 1:if(yy_.yytext.slice(-1)!=="\\")this.begin("mu");if(yy_.yytext.slice(-1)==="\\")yy_.yytext=yy_.yytext.substr(0,yy_.yyleng-1),this.begin("emu");if(yy_.yytext)return 14;break;case 2:return 14;break;case 3:if(yy_.yytext.slice(-1)!=="\\")this.popState();if(yy_.yytext.slice(-1)==="\\")yy_.yytext=yy_.yytext.substr(0,yy_.yyleng-1);return 14;break;case 4:yy_.yytext=yy_.yytext.substr(0,yy_.yyleng-4);this.popState();return 15;break;case 5:return 25;break;case 6:return 16;break;case 7:return 20;break;case 8:return 19;break;case 9:return 19;break;case 10:return 23;break;case 11:return 22;break;case 12:this.popState();this.begin("com");break;case 13:yy_.yytext=yy_.yytext.substr(3,yy_.yyleng-5);this.popState();return 15;break;case 14:return 22;break;case 15:return 37;break;case 16:return 36;break;case 17:return 36;break;case 18:return 40;break;case 19:break;case 20:this.popState();return 24;break;case 21:this.popState();return 18;break;case 22:yy_.yytext=yy_.yytext.substr(1,yy_.yyleng-2).replace(/\\"/g,'"');return 31;break;case 23:yy_.yytext=yy_.yytext.substr(1,yy_.yyleng-2).replace(/\\'/g,"'");return 31;break;case 24:return 38;break;case 25:return 33;break;case 26:return 33;break;case 27:return 32;break;case 28:return 36;break;case 29:yy_.yytext=yy_.yytext.substr(1,yy_.yyleng-2);return 36;break;case 30:return"INVALID";break;case 31:return 5;break}};lexer.rules=[/^(?:\\\\(?=(\{\{)))/,/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|$)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\{\{>)/,/^(?:\{\{#)/,/^(?:\{\{\/)/,/^(?:\{\{\^)/,/^(?:\{\{\s*else\b)/,/^(?:\{\{\{)/,/^(?:\{\{&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{)/,/^(?:=)/,/^(?:\.(?=[}\/ ]))/,/^(?:\.\.)/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}\}\})/,/^(?:\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=[}\s]))/,/^(?:false(?=[}\s]))/,/^(?:-?[0-9]+(?=[}\s]))/,/^(?:[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.]))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/];lexer.conditions={mu:{rules:[5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],inclusive:false},emu:{rules:[3],inclusive:false},com:{rules:[4],inclusive:false},INITIAL:{rules:[0,1,2,31],inclusive:true}};return lexer}();parser.lexer=lexer;function Parser(){this.yy={}}Parser.prototype=parser;parser.Parser=Parser;return new Parser}();Handlebars.Parser=handlebars;Handlebars.parse=function(input){if(input.constructor===Handlebars.AST.ProgramNode){return input}Handlebars.Parser.yy=Handlebars.AST;return Handlebars.Parser.parse(input)};Handlebars.AST={};Handlebars.AST.ProgramNode=function(statements,inverse){this.type="program";this.statements=statements;if(inverse){this.inverse=new Handlebars.AST.ProgramNode(inverse)}};Handlebars.AST.MustacheNode=function(rawParams,hash,unescaped){this.type="mustache";this.escaped=!unescaped;this.hash=hash;var id=this.id=rawParams[0];var params=this.params=rawParams.slice(1);var eligibleHelper=this.eligibleHelper=id.isSimple;this.isHelper=eligibleHelper&&(params.length||hash)};Handlebars.AST.PartialNode=function(partialName,context){this.type="partial";this.partialName=partialName;this.context=context};Handlebars.AST.BlockNode=function(mustache,program,inverse,close){var verifyMatch=function(open,close){if(open.original!==close.original){throw new Handlebars.Exception(open.original+" doesn't match "+close.original)}};verifyMatch(mustache.id,close);this.type="block";this.mustache=mustache;this.program=program;this.inverse=inverse;if(this.inverse&&!this.program){this.isInverse=true}};Handlebars.AST.ContentNode=function(string){this.type="content";this.string=string};Handlebars.AST.HashNode=function(pairs){this.type="hash";this.pairs=pairs};Handlebars.AST.IdNode=function(parts){this.type="ID";var original="",dig=[],depth=0;for(var i=0,l=parts.length;i<l;i++){var part=parts[i].part;original+=(parts[i].separator||"")+part;if(part===".."||part==="."||part==="this"){if(dig.length>0){throw new Handlebars.Exception("Invalid path: "+original)}else if(part===".."){depth++}else{this.isScoped=true}}else{dig.push(part)}}this.original=original;this.parts=dig;this.string=dig.join(".");this.depth=depth;this.isSimple=parts.length===1&&!this.isScoped&&depth===0;this.stringModeValue=this.string};Handlebars.AST.PartialNameNode=function(name){this.type="PARTIAL_NAME";this.name=name.original};Handlebars.AST.DataNode=function(id){this.type="DATA";this.id=id};Handlebars.AST.StringNode=function(string){this.type="STRING";this.original=this.string=this.stringModeValue=string};Handlebars.AST.IntegerNode=function(integer){this.type="INTEGER";this.original=this.integer=integer;this.stringModeValue=Number(integer)};Handlebars.AST.BooleanNode=function(bool){this.type="BOOLEAN";this.bool=bool;this.stringModeValue=bool==="true"};Handlebars.AST.CommentNode=function(comment){this.type="comment";this.comment=comment};var errorProps=["description","fileName","lineNumber","message","name","number","stack"];Handlebars.Exception=function(message){var tmp=Error.prototype.constructor.apply(this,arguments);for(var idx=0;idx<errorProps.length;idx++){this[errorProps[idx]]=tmp[errorProps[idx]]}};Handlebars.Exception.prototype=new Error;Handlebars.SafeString=function(string){this.string=string};Handlebars.SafeString.prototype.toString=function(){return this.string.toString()};var escape={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var badChars=/[&<>"'`]/g;var possible=/[&<>"'`]/;var escapeChar=function(chr){return escape[chr]||"&amp;"};Handlebars.Utils={extend:function(obj,value){for(var key in value){if(value.hasOwnProperty(key)){obj[key]=value[key]}}},escapeExpression:function(string){if(string instanceof Handlebars.SafeString){return string.toString()}else if(string==null||string===false){return""}string=string.toString();if(!possible.test(string)){return string}return string.replace(badChars,escapeChar)},isEmpty:function(value){if(!value&&value!==0){return true}else if(toString.call(value)==="[object Array]"&&value.length===0){return true}else{return false}}};var Compiler=Handlebars.Compiler=function(){};var JavaScriptCompiler=Handlebars.JavaScriptCompiler=function(){};Compiler.prototype={compiler:Compiler,disassemble:function(){var opcodes=this.opcodes,opcode,out=[],params,param;for(var i=0,l=opcodes.length;i<l;i++){opcode=opcodes[i];if(opcode.opcode==="DECLARE"){out.push("DECLARE "+opcode.name+"="+opcode.value)}else{params=[];for(var j=0;j<opcode.args.length;j++){param=opcode.args[j];if(typeof param==="string"){param='"'+param.replace("\n","\\n")+'"'}params.push(param)}out.push(opcode.opcode+" "+params.join(" "))}}return out.join("\n")},equals:function(other){var len=this.opcodes.length;if(other.opcodes.length!==len){return false}for(var i=0;i<len;i++){var opcode=this.opcodes[i],otherOpcode=other.opcodes[i];if(opcode.opcode!==otherOpcode.opcode||opcode.args.length!==otherOpcode.args.length){return false}for(var j=0;j<opcode.args.length;j++){if(opcode.args[j]!==otherOpcode.args[j]){return false}}}len=this.children.length;if(other.children.length!==len){return false}for(i=0;i<len;i++){if(!this.children[i].equals(other.children[i])){return false}}return true},guid:0,compile:function(program,options){this.children=[];this.depths={list:[]};this.options=options;var knownHelpers=this.options.knownHelpers;this.options.knownHelpers={helperMissing:true,blockHelperMissing:true,each:true,"if":true,unless:true,"with":true,log:true};if(knownHelpers){for(var name in knownHelpers){this.options.knownHelpers[name]=knownHelpers[name]}}return this.program(program)},accept:function(node){return this[node.type](node)},program:function(program){var statements=program.statements,statement;this.opcodes=[];for(var i=0,l=statements.length;i<l;i++){statement=statements[i];this[statement.type](statement)}this.isSimple=l===1;this.depths.list=this.depths.list.sort(function(a,b){return a-b});return this},compileProgram:function(program){var result=(new this.compiler).compile(program,this.options);var guid=this.guid++,depth;this.usePartial=this.usePartial||result.usePartial;this.children[guid]=result;for(var i=0,l=result.depths.list.length;i<l;i++){depth=result.depths.list[i];if(depth<2){continue}else{this.addDepth(depth-1)}}return guid},block:function(block){var mustache=block.mustache,program=block.program,inverse=block.inverse;if(program){program=this.compileProgram(program)}if(inverse){inverse=this.compileProgram(inverse)}var type=this.classifyMustache(mustache);if(type==="helper"){this.helperMustache(mustache,program,inverse)}else if(type==="simple"){this.simpleMustache(mustache);this.opcode("pushProgram",program);this.opcode("pushProgram",inverse);this.opcode("emptyHash");this.opcode("blockValue")}else{this.ambiguousMustache(mustache,program,inverse);this.opcode("pushProgram",program);this.opcode("pushProgram",inverse);this.opcode("emptyHash");this.opcode("ambiguousBlockValue")}this.opcode("append")},hash:function(hash){var pairs=hash.pairs,pair,val;this.opcode("pushHash");for(var i=0,l=pairs.length;i<l;i++){pair=pairs[i];val=pair[1];if(this.options.stringParams){if(val.depth){this.addDepth(val.depth)}this.opcode("getContext",val.depth||0);this.opcode("pushStringParam",val.stringModeValue,val.type)}else{this.accept(val)}this.opcode("assignToHash",pair[0])}this.opcode("popHash")},partial:function(partial){var partialName=partial.partialName;this.usePartial=true;if(partial.context){this.ID(partial.context)}else{this.opcode("push","depth0")}this.opcode("invokePartial",partialName.name);this.opcode("append")},content:function(content){this.opcode("appendContent",content.string)},mustache:function(mustache){var options=this.options;var type=this.classifyMustache(mustache);if(type==="simple"){this.simpleMustache(mustache)}else if(type==="helper"){this.helperMustache(mustache)}else{this.ambiguousMustache(mustache)}if(mustache.escaped&&!options.noEscape){this.opcode("appendEscaped")}else{this.opcode("append")}},ambiguousMustache:function(mustache,program,inverse){var id=mustache.id,name=id.parts[0],isBlock=program!=null||inverse!=null;this.opcode("getContext",id.depth);this.opcode("pushProgram",program);this.opcode("pushProgram",inverse);this.opcode("invokeAmbiguous",name,isBlock)},simpleMustache:function(mustache){var id=mustache.id;if(id.type==="DATA"){this.DATA(id)}else if(id.parts.length){this.ID(id)}else{this.addDepth(id.depth);this.opcode("getContext",id.depth);this.opcode("pushContext")}this.opcode("resolvePossibleLambda")},helperMustache:function(mustache,program,inverse){var params=this.setupFullMustacheParams(mustache,program,inverse),name=mustache.id.parts[0];if(this.options.knownHelpers[name]){this.opcode("invokeKnownHelper",params.length,name)}else if(this.options.knownHelpersOnly){throw new Error("You specified knownHelpersOnly, but used the unknown helper "+name)}else{this.opcode("invokeHelper",params.length,name)}},ID:function(id){this.addDepth(id.depth);this.opcode("getContext",id.depth);var name=id.parts[0];if(!name){this.opcode("pushContext")}else{this.opcode("lookupOnContext",id.parts[0])}for(var i=1,l=id.parts.length;i<l;i++){this.opcode("lookup",id.parts[i])}},DATA:function(data){this.options.data=true;if(data.id.isScoped||data.id.depth){throw new Handlebars.Exception("Scoped data references are not supported: "+data.original)}this.opcode("lookupData");var parts=data.id.parts;for(var i=0,l=parts.length;i<l;i++){this.opcode("lookup",parts[i])}},STRING:function(string){this.opcode("pushString",string.string)},INTEGER:function(integer){this.opcode("pushLiteral",integer.integer)},BOOLEAN:function(bool){this.opcode("pushLiteral",bool.bool)},comment:function(){},opcode:function(name){this.opcodes.push({opcode:name,args:[].slice.call(arguments,1)})},declare:function(name,value){this.opcodes.push({opcode:"DECLARE",name:name,value:value})},addDepth:function(depth){if(isNaN(depth)){throw new Error("EWOT")}if(depth===0){return}if(!this.depths[depth]){this.depths[depth]=true;this.depths.list.push(depth)}},classifyMustache:function(mustache){var isHelper=mustache.isHelper;var isEligible=mustache.eligibleHelper;var options=this.options;if(isEligible&&!isHelper){var name=mustache.id.parts[0];if(options.knownHelpers[name]){isHelper=true}else if(options.knownHelpersOnly){isEligible=false}}if(isHelper){return"helper"}else if(isEligible){return"ambiguous"}else{return"simple"}},pushParams:function(params){var i=params.length,param;while(i--){param=params[i];if(this.options.stringParams){if(param.depth){this.addDepth(param.depth)}this.opcode("getContext",param.depth||0);this.opcode("pushStringParam",param.stringModeValue,param.type)}else{this[param.type](param)}}},setupMustacheParams:function(mustache){var params=mustache.params;this.pushParams(params);if(mustache.hash){this.hash(mustache.hash)}else{this.opcode("emptyHash")}return params},setupFullMustacheParams:function(mustache,program,inverse){var params=mustache.params;this.pushParams(params);this.opcode("pushProgram",program);this.opcode("pushProgram",inverse);if(mustache.hash){this.hash(mustache.hash)}else{this.opcode("emptyHash")}return params}};var Literal=function(value){this.value=value};JavaScriptCompiler.prototype={nameLookup:function(parent,name){if(/^[0-9]+$/.test(name)){return parent+"["+name+"]"}else if(JavaScriptCompiler.isValidJavaScriptVariableName(name)){return parent+"."+name}else{return parent+"['"+name+"']"}},appendToBuffer:function(string){if(this.environment.isSimple){return"return "+string+";"}else{return{appendToBuffer:true,content:string,toString:function(){return"buffer += "+string+";"}}}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(environment,options,context,asObject){this.environment=environment;this.options=options||{};Handlebars.log(Handlebars.logger.DEBUG,this.environment.disassemble()+"\n\n");this.name=this.environment.name;this.isChild=!!context;this.context=context||{programs:[],environments:[],aliases:{}};this.preamble();this.stackSlot=0;this.stackVars=[];this.registers={list:[]};this.compileStack=[];this.inlineStack=[];this.compileChildren(environment,options);var opcodes=environment.opcodes,opcode;this.i=0;for(l=opcodes.length;this.i<l;this.i++){opcode=opcodes[this.i];if(opcode.opcode==="DECLARE"){this[opcode.name]=opcode.value}else{this[opcode.opcode].apply(this,opcode.args)}}return this.createFunctionContext(asObject)},nextOpcode:function(){var opcodes=this.environment.opcodes;return opcodes[this.i+1]},eat:function(){this.i=this.i+1},preamble:function(){var out=[];if(!this.isChild){var namespace=this.namespace;var copies="helpers = this.merge(helpers, "+namespace+".helpers);";if(this.environment.usePartial){copies=copies+" partials = this.merge(partials, "+namespace+".partials);"}if(this.options.data){copies=copies+" data = data || {};"}out.push(copies)}else{out.push("")}if(!this.environment.isSimple){out.push(", buffer = "+this.initializeBuffer())}else{out.push("")}this.lastContext=0;this.source=out},createFunctionContext:function(asObject){var locals=this.stackVars.concat(this.registers.list);if(locals.length>0){this.source[1]=this.source[1]+", "+locals.join(", ")}if(!this.isChild){for(var alias in this.context.aliases){if(this.context.aliases.hasOwnProperty(alias)){this.source[1]=this.source[1]+", "+alias+"="+this.context.aliases[alias]}}}if(this.source[1]){this.source[1]="var "+this.source[1].substring(2)+";"}if(!this.isChild){this.source[1]+="\n"+this.context.programs.join("\n")+"\n"}if(!this.environment.isSimple){this.source.push("return buffer;")}var params=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"];for(var i=0,l=this.environment.depths.list.length;i<l;i++){params.push("depth"+this.environment.depths.list[i])}var source=this.mergeSource();if(!this.isChild){var revision=Handlebars.COMPILER_REVISION,versions=Handlebars.REVISION_CHANGES[revision];source="this.compilerInfo = ["+revision+",'"+versions+"'];\n"+source}if(asObject){params.push(source);return Function.apply(this,params)}else{var functionSource="function "+(this.name||"")+"("+params.join(",")+") {\n  "+source+"}";Handlebars.log(Handlebars.logger.DEBUG,functionSource+"\n\n");return functionSource}},mergeSource:function(){var source="",buffer;for(var i=0,len=this.source.length;i<len;i++){var line=this.source[i];if(line.appendToBuffer){if(buffer){buffer=buffer+"\n    + "+line.content}else{buffer=line.content}}else{if(buffer){source+="buffer += "+buffer+";\n  ";buffer=undefined}source+=line+"\n  "}}return source},blockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var params=["depth0"];this.setupParams(0,params);this.replaceStack(function(current){params.splice(1,0,current);return"blockHelperMissing.call("+params.join(", ")+")"})},ambiguousBlockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var params=["depth0"];this.setupParams(0,params);var current=this.topStack();params.splice(1,0,current);params[params.length-1]="options";this.source.push("if (!"+this.lastHelper+") { "+current+" = blockHelperMissing.call("+params.join(", ")+"); }")},appendContent:function(content){this.source.push(this.appendToBuffer(this.quotedString(content)))},append:function(){this.flushInline();var local=this.popStack();this.source.push("if("+local+" || "+local+" === 0) { "+this.appendToBuffer(local)+" }");if(this.environment.isSimple){this.source.push("else { "+this.appendToBuffer("''")+" }")}},appendEscaped:function(){this.context.aliases.escapeExpression="this.escapeExpression";this.source.push(this.appendToBuffer("escapeExpression("+this.popStack()+")"))},getContext:function(depth){if(this.lastContext!==depth){this.lastContext=depth}},lookupOnContext:function(name){this.push(this.nameLookup("depth"+this.lastContext,name,"context"))},pushContext:function(){this.pushStackLiteral("depth"+this.lastContext)},resolvePossibleLambda:function(){this.context.aliases.functionType='"function"';this.replaceStack(function(current){return"typeof "+current+" === functionType ? "+current+".apply(depth0) : "+current})},lookup:function(name){this.replaceStack(function(current){return current+" == null || "+current+" === false ? "+current+" : "+this.nameLookup(current,name,"context")})},lookupData:function(id){this.push("data")},pushStringParam:function(string,type){this.pushStackLiteral("depth"+this.lastContext);this.pushString(type);if(typeof string==="string"){this.pushString(string)}else{this.pushStackLiteral(string)}},emptyHash:function(){this.pushStackLiteral("{}");if(this.options.stringParams){this.register("hashTypes","{}");this.register("hashContexts","{}")}},pushHash:function(){this.hash={values:[],types:[],contexts:[]}},popHash:function(){var hash=this.hash;this.hash=undefined;if(this.options.stringParams){this.register("hashContexts","{"+hash.contexts.join(",")+"}");this.register("hashTypes","{"+hash.types.join(",")+"}")}this.push("{\n    "+hash.values.join(",\n    ")+"\n  }")},pushString:function(string){this.pushStackLiteral(this.quotedString(string))},push:function(expr){this.inlineStack.push(expr);return expr},pushLiteral:function(value){this.pushStackLiteral(value)},pushProgram:function(guid){if(guid!=null){this.pushStackLiteral(this.programExpression(guid))}else{this.pushStackLiteral(null)}},invokeHelper:function(paramSize,name){this.context.aliases.helperMissing="helpers.helperMissing";var helper=this.lastHelper=this.setupHelper(paramSize,name,true);var nonHelper=this.nameLookup("depth"+this.lastContext,name,"context");this.push(helper.name+" || "+nonHelper);this.replaceStack(function(name){return name+" ? "+name+".call("+helper.callParams+") "+": helperMissing.call("+helper.helperMissingParams+")"})},invokeKnownHelper:function(paramSize,name){var helper=this.setupHelper(paramSize,name);this.push(helper.name+".call("+helper.callParams+")")},invokeAmbiguous:function(name,helperCall){this.context.aliases.functionType='"function"';this.pushStackLiteral("{}");var helper=this.setupHelper(0,name,helperCall);var helperName=this.lastHelper=this.nameLookup("helpers",name,"helper");var nonHelper=this.nameLookup("depth"+this.lastContext,name,"context");var nextStack=this.nextStack();this.source.push("if ("+nextStack+" = "+helperName+") { "+nextStack+" = "+nextStack+".call("+helper.callParams+"); }");this.source.push("else { "+nextStack+" = "+nonHelper+"; "+nextStack+" = typeof "+nextStack+" === functionType ? "+nextStack+".apply(depth0) : "+nextStack+"; }")},invokePartial:function(name){var params=[this.nameLookup("partials",name,"partial"),"'"+name+"'",this.popStack(),"helpers","partials"];if(this.options.data){params.push("data")}this.context.aliases.self="this";this.push("self.invokePartial("+params.join(", ")+")")},assignToHash:function(key){var value=this.popStack(),context,type;if(this.options.stringParams){type=this.popStack();context=this.popStack()}var hash=this.hash;if(context){hash.contexts.push("'"+key+"': "+context)}if(type){hash.types.push("'"+key+"': "+type)}hash.values.push("'"+key+"': ("+value+")")},compiler:JavaScriptCompiler,compileChildren:function(environment,options){var children=environment.children,child,compiler;for(var i=0,l=children.length;i<l;i++){child=children[i];compiler=new this.compiler;var index=this.matchExistingProgram(child);if(index==null){this.context.programs.push("");index=this.context.programs.length;child.index=index;child.name="program"+index;this.context.programs[index]=compiler.compile(child,options,this.context);this.context.environments[index]=child}else{child.index=index;child.name="program"+index}}},matchExistingProgram:function(child){for(var i=0,len=this.context.environments.length;i<len;i++){var environment=this.context.environments[i];if(environment&&environment.equals(child)){return i}}},programExpression:function(guid){this.context.aliases.self="this";if(guid==null){return"self.noop"}var child=this.environment.children[guid],depths=child.depths.list,depth;var programParams=[child.index,child.name,"data"];for(var i=0,l=depths.length;i<l;i++){depth=depths[i];if(depth===1){programParams.push("depth0")}else{programParams.push("depth"+(depth-1))}}return(depths.length===0?"self.program(":"self.programWithDepth(")+programParams.join(", ")+")"},register:function(name,val){this.useRegister(name);this.source.push(name+" = "+val+";")},useRegister:function(name){if(!this.registers[name]){this.registers[name]=true;this.registers.list.push(name)}},pushStackLiteral:function(item){return this.push(new Literal(item))},pushStack:function(item){this.flushInline();var stack=this.incrStack();if(item){this.source.push(stack+" = "+item+";")}this.compileStack.push(stack);return stack},replaceStack:function(callback){var prefix="",inline=this.isInline(),stack;if(inline){var top=this.popStack(true);if(top instanceof Literal){stack=top.value}else{var name=this.stackSlot?this.topStackName():this.incrStack();prefix="("+this.push(name)+" = "+top+"),";stack=this.topStack()}}else{stack=this.topStack()}var item=callback.call(this,stack);if(inline){if(this.inlineStack.length||this.compileStack.length){this.popStack()}this.push("("+prefix+item+")")}else{if(!/^stack/.test(stack)){stack=this.nextStack()}this.source.push(stack+" = ("+prefix+item+");")}return stack},nextStack:function(){return this.pushStack()},incrStack:function(){this.stackSlot++;if(this.stackSlot>this.stackVars.length){this.stackVars.push("stack"+this.stackSlot)}return this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var inlineStack=this.inlineStack;if(inlineStack.length){this.inlineStack=[];for(var i=0,len=inlineStack.length;i<len;i++){var entry=inlineStack[i];if(entry instanceof Literal){this.compileStack.push(entry)}else{this.pushStack(entry)}}}},isInline:function(){return this.inlineStack.length},popStack:function(wrapped){var inline=this.isInline(),item=(inline?this.inlineStack:this.compileStack).pop();if(!wrapped&&item instanceof Literal){return item.value}else{if(!inline){this.stackSlot--}return item}},topStack:function(wrapped){var stack=this.isInline()?this.inlineStack:this.compileStack,item=stack[stack.length-1];if(!wrapped&&item instanceof Literal){return item.value}else{return item}},quotedString:function(str){return'"'+str.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},setupHelper:function(paramSize,name,missingParams){var params=[];this.setupParams(paramSize,params,missingParams);var foundHelper=this.nameLookup("helpers",name,"helper");return{params:params,name:foundHelper,callParams:["depth0"].concat(params).join(", "),helperMissingParams:missingParams&&["depth0",this.quotedString(name)].concat(params).join(", ")}},setupParams:function(paramSize,params,useRegister){var options=[],contexts=[],types=[],param,inverse,program;options.push("hash:"+this.popStack());inverse=this.popStack();program=this.popStack();if(program||inverse){if(!program){this.context.aliases.self="this";program="self.noop"}if(!inverse){this.context.aliases.self="this";inverse="self.noop"}options.push("inverse:"+inverse);options.push("fn:"+program)}for(var i=0;i<paramSize;i++){param=this.popStack();params.push(param);if(this.options.stringParams){types.push(this.popStack());contexts.push(this.popStack())}}if(this.options.stringParams){options.push("contexts:["+contexts.join(",")+"]");options.push("types:["+types.join(",")+"]");options.push("hashContexts:hashContexts");options.push("hashTypes:hashTypes")}if(this.options.data){options.push("data:data")}options="{"+options.join(",")+"}";if(useRegister){this.register("options",options);params.push("options")}else{params.push(options)}return params.join(", ")}};var reservedWords=("break else new var"+" case finally return void"+" catch for switch while"+" continue function this with"+" default if throw"+" delete in try"+" do instanceof typeof"+" abstract enum int short"+" boolean export interface static"+" byte extends long super"+" char final native synchronized"+" class float package throws"+" const goto private transient"+" debugger implements protected volatile"+" double import public let yield").split(" ");var compilerWords=JavaScriptCompiler.RESERVED_WORDS={};for(var i=0,l=reservedWords.length;i<l;i++){compilerWords[reservedWords[i]]=true}JavaScriptCompiler.isValidJavaScriptVariableName=function(name){if(!JavaScriptCompiler.RESERVED_WORDS[name]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(name)){return true}return false};Handlebars.precompile=function(input,options){if(input==null||typeof input!=="string"&&input.constructor!==Handlebars.AST.ProgramNode){throw new Handlebars.Exception("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+input)}options=options||{};if(!("data"in options)){options.data=true}var ast=Handlebars.parse(input);var environment=(new Compiler).compile(ast,options);return(new JavaScriptCompiler).compile(environment,options)};Handlebars.compile=function(input,options){if(input==null||typeof input!=="string"&&input.constructor!==Handlebars.AST.ProgramNode){throw new Handlebars.Exception("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+input)}options=options||{};if(!("data"in options)){options.data=true}var compiled;function compile(){var ast=Handlebars.parse(input);var environment=(new Compiler).compile(ast,options);var templateSpec=(new JavaScriptCompiler).compile(environment,options,undefined,true);return Handlebars.template(templateSpec)}return function(context,options){if(!compiled){compiled=compile()}return compiled.call(this,context,options)}};Handlebars.VM={template:function(templateSpec){var container={escapeExpression:Handlebars.Utils.escapeExpression,invokePartial:Handlebars.VM.invokePartial,programs:[],program:function(i,fn,data){var programWrapper=this.programs[i];if(data){programWrapper=Handlebars.VM.program(i,fn,data)}else if(!programWrapper){programWrapper=this.programs[i]=Handlebars.VM.program(i,fn)}return programWrapper},merge:function(param,common){var ret=param||common;if(param&&common){ret={};Handlebars.Utils.extend(ret,common);Handlebars.Utils.extend(ret,param)}return ret},programWithDepth:Handlebars.VM.programWithDepth,noop:Handlebars.VM.noop,compilerInfo:null};return function(context,options){options=options||{};var result=templateSpec.call(container,Handlebars,context,options.helpers,options.partials,options.data);var compilerInfo=container.compilerInfo||[],compilerRevision=compilerInfo[0]||1,currentRevision=Handlebars.COMPILER_REVISION;if(compilerRevision!==currentRevision){if(compilerRevision<currentRevision){var runtimeVersions=Handlebars.REVISION_CHANGES[currentRevision],compilerVersions=Handlebars.REVISION_CHANGES[compilerRevision];throw"Template was precompiled with an older version of Handlebars than the current runtime. "+"Please update your precompiler to a newer version ("+runtimeVersions+") or downgrade your runtime to an older version ("+compilerVersions+")."}else{throw"Template was precompiled with a newer version of Handlebars than the current runtime. "+"Please update your runtime to a newer version ("+compilerInfo[1]+")."}}return result}},programWithDepth:function(i,fn,data){var args=Array.prototype.slice.call(arguments,3);var program=function(context,options){options=options||{};return fn.apply(this,[context,options.data||data].concat(args))};program.program=i;program.depth=args.length;return program},program:function(i,fn,data){var program=function(context,options){options=options||{};return fn(context,options.data||data)};program.program=i;program.depth=0;return program},noop:function(){return""},invokePartial:function(partial,name,context,helpers,partials,data){var options={helpers:helpers,partials:partials,data:data};if(partial===undefined){throw new Handlebars.Exception("The partial "+name+" could not be found")}else if(partial instanceof Function){return partial(context,options)}else if(!Handlebars.compile){throw new Handlebars.Exception("The partial "+name+" could not be compiled when running in runtime-only mode")}else{partials[name]=Handlebars.compile(partial,{data:data!==undefined});return partials[name](context,options)}}};Handlebars.template=Handlebars.VM.template})(Handlebars);IBTX.thirdParty.Handlebars=Handlebars})();IBTX.Mod.autoloadApps=function(){"use strict";function createListener(appController,selector){return new IBTX.Hlp.Obj.DomCreateListener(selector,function(elm){appController.find(elm)})}IBTX.whenStarted(function(){var app,selector;for(app in IBTX.App){if(IBTX.App.hasOwnProperty(app)){selector=IBTX.App[app].selector;if(selector){createListener(IBTX.App[app],selector)}}}})}();(function(){function diff_match_patch(){this.Diff_Timeout=1;this.Diff_EditCost=4;this.Match_Threshold=.5;this.Match_Distance=1e3;this.Patch_DeleteThreshold=.5;this.Patch_Margin=4;this.Match_MaxBits=32}var DIFF_DELETE=-1;var DIFF_INSERT=1;var DIFF_EQUAL=0;diff_match_patch.Diff;
diff_match_patch.prototype.diff_main=function(text1,text2,opt_checklines,opt_deadline){if(typeof opt_deadline=="undefined"){if(this.Diff_Timeout<=0){opt_deadline=Number.MAX_VALUE}else{opt_deadline=(new Date).getTime()+this.Diff_Timeout*1e3}}var deadline=opt_deadline;if(text1==null||text2==null){throw new Error("Null input. (diff_main)")}if(text1==text2){if(text1){return[[DIFF_EQUAL,text1]]}return[]}if(typeof opt_checklines=="undefined"){opt_checklines=true}var checklines=opt_checklines;var commonlength=this.diff_commonPrefix(text1,text2);var commonprefix=text1.substring(0,commonlength);text1=text1.substring(commonlength);text2=text2.substring(commonlength);commonlength=this.diff_commonSuffix(text1,text2);var commonsuffix=text1.substring(text1.length-commonlength);text1=text1.substring(0,text1.length-commonlength);text2=text2.substring(0,text2.length-commonlength);var diffs=this.diff_compute_(text1,text2,checklines,deadline);if(commonprefix){diffs.unshift([DIFF_EQUAL,commonprefix])}if(commonsuffix){diffs.push([DIFF_EQUAL,commonsuffix])}this.diff_cleanupMerge(diffs);return diffs};diff_match_patch.prototype.diff_compute_=function(text1,text2,checklines,deadline){var diffs;if(!text1){return[[DIFF_INSERT,text2]]}if(!text2){return[[DIFF_DELETE,text1]]}var longtext=text1.length>text2.length?text1:text2;var shorttext=text1.length>text2.length?text2:text1;var i=longtext.indexOf(shorttext);if(i!=-1){diffs=[[DIFF_INSERT,longtext.substring(0,i)],[DIFF_EQUAL,shorttext],[DIFF_INSERT,longtext.substring(i+shorttext.length)]];if(text1.length>text2.length){diffs[0][0]=diffs[2][0]=DIFF_DELETE}return diffs}if(shorttext.length==1){return[[DIFF_DELETE,text1],[DIFF_INSERT,text2]]}var hm=this.diff_halfMatch_(text1,text2);if(hm){var text1_a=hm[0];var text1_b=hm[1];var text2_a=hm[2];var text2_b=hm[3];var mid_common=hm[4];var diffs_a=this.diff_main(text1_a,text2_a,checklines,deadline);var diffs_b=this.diff_main(text1_b,text2_b,checklines,deadline);return diffs_a.concat([[DIFF_EQUAL,mid_common]],diffs_b)}if(checklines&&text1.length>100&&text2.length>100){return this.diff_lineMode_(text1,text2,deadline)}return this.diff_bisect_(text1,text2,deadline)};diff_match_patch.prototype.diff_lineMode_=function(text1,text2,deadline){var a=this.diff_linesToChars_(text1,text2);text1=a.chars1;text2=a.chars2;var linearray=a.lineArray;var diffs=this.diff_main(text1,text2,false,deadline);this.diff_charsToLines_(diffs,linearray);this.diff_cleanupSemantic(diffs);diffs.push([DIFF_EQUAL,""]);var pointer=0;var count_delete=0;var count_insert=0;var text_delete="";var text_insert="";while(pointer<diffs.length){switch(diffs[pointer][0]){case DIFF_INSERT:count_insert++;text_insert+=diffs[pointer][1];break;case DIFF_DELETE:count_delete++;text_delete+=diffs[pointer][1];break;case DIFF_EQUAL:if(count_delete>=1&&count_insert>=1){diffs.splice(pointer-count_delete-count_insert,count_delete+count_insert);pointer=pointer-count_delete-count_insert;var a=this.diff_main(text_delete,text_insert,false,deadline);for(var j=a.length-1;j>=0;j--){diffs.splice(pointer,0,a[j])}pointer=pointer+a.length}count_insert=0;count_delete=0;text_delete="";text_insert="";break}pointer++}diffs.pop();return diffs};diff_match_patch.prototype.diff_bisect_=function(text1,text2,deadline){var text1_length=text1.length;var text2_length=text2.length;var max_d=Math.ceil((text1_length+text2_length)/2);var v_offset=max_d;var v_length=2*max_d;var v1=new Array(v_length);var v2=new Array(v_length);for(var x=0;x<v_length;x++){v1[x]=-1;v2[x]=-1}v1[v_offset+1]=0;v2[v_offset+1]=0;var delta=text1_length-text2_length;var front=delta%2!=0;var k1start=0;var k1end=0;var k2start=0;var k2end=0;for(var d=0;d<max_d;d++){if((new Date).getTime()>deadline){break}for(var k1=-d+k1start;k1<=d-k1end;k1+=2){var k1_offset=v_offset+k1;var x1;if(k1==-d||k1!=d&&v1[k1_offset-1]<v1[k1_offset+1]){x1=v1[k1_offset+1]}else{x1=v1[k1_offset-1]+1}var y1=x1-k1;while(x1<text1_length&&y1<text2_length&&text1.charAt(x1)==text2.charAt(y1)){x1++;y1++}v1[k1_offset]=x1;if(x1>text1_length){k1end+=2}else if(y1>text2_length){k1start+=2}else if(front){var k2_offset=v_offset+delta-k1;if(k2_offset>=0&&k2_offset<v_length&&v2[k2_offset]!=-1){var x2=text1_length-v2[k2_offset];if(x1>=x2){return this.diff_bisectSplit_(text1,text2,x1,y1,deadline)}}}}for(var k2=-d+k2start;k2<=d-k2end;k2+=2){var k2_offset=v_offset+k2;var x2;if(k2==-d||k2!=d&&v2[k2_offset-1]<v2[k2_offset+1]){x2=v2[k2_offset+1]}else{x2=v2[k2_offset-1]+1}var y2=x2-k2;while(x2<text1_length&&y2<text2_length&&text1.charAt(text1_length-x2-1)==text2.charAt(text2_length-y2-1)){x2++;y2++}v2[k2_offset]=x2;if(x2>text1_length){k2end+=2}else if(y2>text2_length){k2start+=2}else if(!front){var k1_offset=v_offset+delta-k2;if(k1_offset>=0&&k1_offset<v_length&&v1[k1_offset]!=-1){var x1=v1[k1_offset];var y1=v_offset+x1-k1_offset;x2=text1_length-x2;if(x1>=x2){return this.diff_bisectSplit_(text1,text2,x1,y1,deadline)}}}}}return[[DIFF_DELETE,text1],[DIFF_INSERT,text2]]};diff_match_patch.prototype.diff_bisectSplit_=function(text1,text2,x,y,deadline){var text1a=text1.substring(0,x);var text2a=text2.substring(0,y);var text1b=text1.substring(x);var text2b=text2.substring(y);var diffs=this.diff_main(text1a,text2a,false,deadline);var diffsb=this.diff_main(text1b,text2b,false,deadline);return diffs.concat(diffsb)};diff_match_patch.prototype.diff_linesToChars_=function(text1,text2){var lineArray=[];var lineHash={};lineArray[0]="";function diff_linesToCharsMunge_(text){var chars="";var lineStart=0;var lineEnd=-1;var lineArrayLength=lineArray.length;while(lineEnd<text.length-1){lineEnd=text.indexOf("\n",lineStart);if(lineEnd==-1){lineEnd=text.length-1}var line=text.substring(lineStart,lineEnd+1);lineStart=lineEnd+1;if(lineHash.hasOwnProperty?lineHash.hasOwnProperty(line):lineHash[line]!==undefined){chars+=String.fromCharCode(lineHash[line])}else{chars+=String.fromCharCode(lineArrayLength);lineHash[line]=lineArrayLength;lineArray[lineArrayLength++]=line}}return chars}var chars1=diff_linesToCharsMunge_(text1);var chars2=diff_linesToCharsMunge_(text2);return{chars1:chars1,chars2:chars2,lineArray:lineArray}};diff_match_patch.prototype.diff_charsToLines_=function(diffs,lineArray){for(var x=0;x<diffs.length;x++){var chars=diffs[x][1];var text=[];for(var y=0;y<chars.length;y++){text[y]=lineArray[chars.charCodeAt(y)]}diffs[x][1]=text.join("")}};diff_match_patch.prototype.diff_commonPrefix=function(text1,text2){if(!text1||!text2||text1.charAt(0)!=text2.charAt(0)){return 0}var pointermin=0;var pointermax=Math.min(text1.length,text2.length);var pointermid=pointermax;var pointerstart=0;while(pointermin<pointermid){if(text1.substring(pointerstart,pointermid)==text2.substring(pointerstart,pointermid)){pointermin=pointermid;pointerstart=pointermin}else{pointermax=pointermid}pointermid=Math.floor((pointermax-pointermin)/2+pointermin)}return pointermid};diff_match_patch.prototype.diff_commonSuffix=function(text1,text2){if(!text1||!text2||text1.charAt(text1.length-1)!=text2.charAt(text2.length-1)){return 0}var pointermin=0;var pointermax=Math.min(text1.length,text2.length);var pointermid=pointermax;var pointerend=0;while(pointermin<pointermid){if(text1.substring(text1.length-pointermid,text1.length-pointerend)==text2.substring(text2.length-pointermid,text2.length-pointerend)){pointermin=pointermid;pointerend=pointermin}else{pointermax=pointermid}pointermid=Math.floor((pointermax-pointermin)/2+pointermin)}return pointermid};diff_match_patch.prototype.diff_commonOverlap_=function(text1,text2){var text1_length=text1.length;var text2_length=text2.length;if(text1_length==0||text2_length==0){return 0}if(text1_length>text2_length){text1=text1.substring(text1_length-text2_length)}else if(text1_length<text2_length){text2=text2.substring(0,text1_length)}var text_length=Math.min(text1_length,text2_length);if(text1==text2){return text_length}var best=0;var length=1;while(true){var pattern=text1.substring(text_length-length);var found=text2.indexOf(pattern);if(found==-1){return best}length+=found;if(found==0||text1.substring(text_length-length)==text2.substring(0,length)){best=length;length++}}};diff_match_patch.prototype.diff_halfMatch_=function(text1,text2){if(this.Diff_Timeout<=0){return null}var longtext=text1.length>text2.length?text1:text2;var shorttext=text1.length>text2.length?text2:text1;if(longtext.length<4||shorttext.length*2<longtext.length){return null}var dmp=this;function diff_halfMatchI_(longtext,shorttext,i){var seed=longtext.substring(i,i+Math.floor(longtext.length/4));var j=-1;var best_common="";var best_longtext_a,best_longtext_b,best_shorttext_a,best_shorttext_b;while((j=shorttext.indexOf(seed,j+1))!=-1){var prefixLength=dmp.diff_commonPrefix(longtext.substring(i),shorttext.substring(j));var suffixLength=dmp.diff_commonSuffix(longtext.substring(0,i),shorttext.substring(0,j));if(best_common.length<suffixLength+prefixLength){best_common=shorttext.substring(j-suffixLength,j)+shorttext.substring(j,j+prefixLength);best_longtext_a=longtext.substring(0,i-suffixLength);best_longtext_b=longtext.substring(i+prefixLength);best_shorttext_a=shorttext.substring(0,j-suffixLength);best_shorttext_b=shorttext.substring(j+prefixLength)}}if(best_common.length*2>=longtext.length){return[best_longtext_a,best_longtext_b,best_shorttext_a,best_shorttext_b,best_common]}else{return null}}var hm1=diff_halfMatchI_(longtext,shorttext,Math.ceil(longtext.length/4));var hm2=diff_halfMatchI_(longtext,shorttext,Math.ceil(longtext.length/2));var hm;if(!hm1&&!hm2){return null}else if(!hm2){hm=hm1}else if(!hm1){hm=hm2}else{hm=hm1[4].length>hm2[4].length?hm1:hm2}var text1_a,text1_b,text2_a,text2_b;if(text1.length>text2.length){text1_a=hm[0];text1_b=hm[1];text2_a=hm[2];text2_b=hm[3]}else{text2_a=hm[0];text2_b=hm[1];text1_a=hm[2];text1_b=hm[3]}var mid_common=hm[4];return[text1_a,text1_b,text2_a,text2_b,mid_common]};diff_match_patch.prototype.diff_cleanupSemantic=function(diffs){var changes=false;var equalities=[];var equalitiesLength=0;var lastequality=null;var pointer=0;var length_insertions1=0;var length_deletions1=0;var length_insertions2=0;var length_deletions2=0;while(pointer<diffs.length){if(diffs[pointer][0]==DIFF_EQUAL){equalities[equalitiesLength++]=pointer;length_insertions1=length_insertions2;length_deletions1=length_deletions2;length_insertions2=0;length_deletions2=0;lastequality=diffs[pointer][1]}else{if(diffs[pointer][0]==DIFF_INSERT){length_insertions2+=diffs[pointer][1].length}else{length_deletions2+=diffs[pointer][1].length}if(lastequality&&lastequality.length<=Math.max(length_insertions1,length_deletions1)&&lastequality.length<=Math.max(length_insertions2,length_deletions2)){diffs.splice(equalities[equalitiesLength-1],0,[DIFF_DELETE,lastequality]);diffs[equalities[equalitiesLength-1]+1][0]=DIFF_INSERT;equalitiesLength--;equalitiesLength--;pointer=equalitiesLength>0?equalities[equalitiesLength-1]:-1;length_insertions1=0;length_deletions1=0;length_insertions2=0;length_deletions2=0;lastequality=null;changes=true}}pointer++}if(changes){this.diff_cleanupMerge(diffs)}this.diff_cleanupSemanticLossless(diffs);pointer=1;while(pointer<diffs.length){if(diffs[pointer-1][0]==DIFF_DELETE&&diffs[pointer][0]==DIFF_INSERT){var deletion=diffs[pointer-1][1];var insertion=diffs[pointer][1];var overlap_length1=this.diff_commonOverlap_(deletion,insertion);var overlap_length2=this.diff_commonOverlap_(insertion,deletion);if(overlap_length1>=overlap_length2){if(overlap_length1>=deletion.length/2||overlap_length1>=insertion.length/2){diffs.splice(pointer,0,[DIFF_EQUAL,insertion.substring(0,overlap_length1)]);diffs[pointer-1][1]=deletion.substring(0,deletion.length-overlap_length1);diffs[pointer+1][1]=insertion.substring(overlap_length1);pointer++}}else{if(overlap_length2>=deletion.length/2||overlap_length2>=insertion.length/2){diffs.splice(pointer,0,[DIFF_EQUAL,deletion.substring(0,overlap_length2)]);diffs[pointer-1][0]=DIFF_INSERT;diffs[pointer-1][1]=insertion.substring(0,insertion.length-overlap_length2);diffs[pointer+1][0]=DIFF_DELETE;diffs[pointer+1][1]=deletion.substring(overlap_length2);pointer++}}pointer++}pointer++}};diff_match_patch.prototype.diff_cleanupSemanticLossless=function(diffs){function diff_cleanupSemanticScore_(one,two){if(!one||!two){return 6}var char1=one.charAt(one.length-1);var char2=two.charAt(0);var nonAlphaNumeric1=char1.match(diff_match_patch.nonAlphaNumericRegex_);var nonAlphaNumeric2=char2.match(diff_match_patch.nonAlphaNumericRegex_);var whitespace1=nonAlphaNumeric1&&char1.match(diff_match_patch.whitespaceRegex_);var whitespace2=nonAlphaNumeric2&&char2.match(diff_match_patch.whitespaceRegex_);var lineBreak1=whitespace1&&char1.match(diff_match_patch.linebreakRegex_);var lineBreak2=whitespace2&&char2.match(diff_match_patch.linebreakRegex_);var blankLine1=lineBreak1&&one.match(diff_match_patch.blanklineEndRegex_);var blankLine2=lineBreak2&&two.match(diff_match_patch.blanklineStartRegex_);if(blankLine1||blankLine2){return 5}else if(lineBreak1||lineBreak2){return 4}else if(nonAlphaNumeric1&&!whitespace1&&whitespace2){return 3}else if(whitespace1||whitespace2){return 2}else if(nonAlphaNumeric1||nonAlphaNumeric2){return 1}return 0}var pointer=1;while(pointer<diffs.length-1){if(diffs[pointer-1][0]==DIFF_EQUAL&&diffs[pointer+1][0]==DIFF_EQUAL){var equality1=diffs[pointer-1][1];var edit=diffs[pointer][1];var equality2=diffs[pointer+1][1];var commonOffset=this.diff_commonSuffix(equality1,edit);if(commonOffset){var commonString=edit.substring(edit.length-commonOffset);equality1=equality1.substring(0,equality1.length-commonOffset);edit=commonString+edit.substring(0,edit.length-commonOffset);equality2=commonString+equality2}var bestEquality1=equality1;var bestEdit=edit;var bestEquality2=equality2;var bestScore=diff_cleanupSemanticScore_(equality1,edit)+diff_cleanupSemanticScore_(edit,equality2);while(edit.charAt(0)===equality2.charAt(0)){equality1+=edit.charAt(0);edit=edit.substring(1)+equality2.charAt(0);equality2=equality2.substring(1);var score=diff_cleanupSemanticScore_(equality1,edit)+diff_cleanupSemanticScore_(edit,equality2);if(score>=bestScore){bestScore=score;bestEquality1=equality1;bestEdit=edit;bestEquality2=equality2}}if(diffs[pointer-1][1]!=bestEquality1){if(bestEquality1){diffs[pointer-1][1]=bestEquality1}else{diffs.splice(pointer-1,1);pointer--}diffs[pointer][1]=bestEdit;if(bestEquality2){diffs[pointer+1][1]=bestEquality2}else{diffs.splice(pointer+1,1);pointer--}}}pointer++}};diff_match_patch.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/;diff_match_patch.whitespaceRegex_=/\s/;diff_match_patch.linebreakRegex_=/[\r\n]/;diff_match_patch.blanklineEndRegex_=/\n\r?\n$/;diff_match_patch.blanklineStartRegex_=/^\r?\n\r?\n/;diff_match_patch.prototype.diff_cleanupEfficiency=function(diffs){var changes=false;var equalities=[];var equalitiesLength=0;var lastequality=null;var pointer=0;var pre_ins=false;var pre_del=false;var post_ins=false;var post_del=false;while(pointer<diffs.length){if(diffs[pointer][0]==DIFF_EQUAL){if(diffs[pointer][1].length<this.Diff_EditCost&&(post_ins||post_del)){equalities[equalitiesLength++]=pointer;pre_ins=post_ins;pre_del=post_del;lastequality=diffs[pointer][1]}else{equalitiesLength=0;lastequality=null}post_ins=post_del=false}else{if(diffs[pointer][0]==DIFF_DELETE){post_del=true}else{post_ins=true}if(lastequality&&(pre_ins&&pre_del&&post_ins&&post_del||lastequality.length<this.Diff_EditCost/2&&pre_ins+pre_del+post_ins+post_del==3)){diffs.splice(equalities[equalitiesLength-1],0,[DIFF_DELETE,lastequality]);diffs[equalities[equalitiesLength-1]+1][0]=DIFF_INSERT;equalitiesLength--;lastequality=null;if(pre_ins&&pre_del){post_ins=post_del=true;equalitiesLength=0}else{equalitiesLength--;pointer=equalitiesLength>0?equalities[equalitiesLength-1]:-1;post_ins=post_del=false}changes=true}}pointer++}if(changes){this.diff_cleanupMerge(diffs)}};diff_match_patch.prototype.diff_cleanupMerge=function(diffs){diffs.push([DIFF_EQUAL,""]);var pointer=0;var count_delete=0;var count_insert=0;var text_delete="";var text_insert="";var commonlength;while(pointer<diffs.length){switch(diffs[pointer][0]){case DIFF_INSERT:count_insert++;text_insert+=diffs[pointer][1];pointer++;break;case DIFF_DELETE:count_delete++;text_delete+=diffs[pointer][1];pointer++;break;case DIFF_EQUAL:if(count_delete+count_insert>1){if(count_delete!==0&&count_insert!==0){commonlength=this.diff_commonPrefix(text_insert,text_delete);if(commonlength!==0){if(pointer-count_delete-count_insert>0&&diffs[pointer-count_delete-count_insert-1][0]==DIFF_EQUAL){diffs[pointer-count_delete-count_insert-1][1]+=text_insert.substring(0,commonlength)}else{diffs.splice(0,0,[DIFF_EQUAL,text_insert.substring(0,commonlength)]);pointer++}text_insert=text_insert.substring(commonlength);text_delete=text_delete.substring(commonlength)}commonlength=this.diff_commonSuffix(text_insert,text_delete);if(commonlength!==0){diffs[pointer][1]=text_insert.substring(text_insert.length-commonlength)+diffs[pointer][1];text_insert=text_insert.substring(0,text_insert.length-commonlength);text_delete=text_delete.substring(0,text_delete.length-commonlength)}}if(count_delete===0){diffs.splice(pointer-count_insert,count_delete+count_insert,[DIFF_INSERT,text_insert])}else if(count_insert===0){diffs.splice(pointer-count_delete,count_delete+count_insert,[DIFF_DELETE,text_delete])}else{diffs.splice(pointer-count_delete-count_insert,count_delete+count_insert,[DIFF_DELETE,text_delete],[DIFF_INSERT,text_insert])}pointer=pointer-count_delete-count_insert+(count_delete?1:0)+(count_insert?1:0)+1}else if(pointer!==0&&diffs[pointer-1][0]==DIFF_EQUAL){diffs[pointer-1][1]+=diffs[pointer][1];diffs.splice(pointer,1)}else{pointer++}count_insert=0;count_delete=0;text_delete="";text_insert="";break}}if(diffs[diffs.length-1][1]===""){diffs.pop()}var changes=false;pointer=1;while(pointer<diffs.length-1){if(diffs[pointer-1][0]==DIFF_EQUAL&&diffs[pointer+1][0]==DIFF_EQUAL){if(diffs[pointer][1].substring(diffs[pointer][1].length-diffs[pointer-1][1].length)==diffs[pointer-1][1]){diffs[pointer][1]=diffs[pointer-1][1]+diffs[pointer][1].substring(0,diffs[pointer][1].length-diffs[pointer-1][1].length);diffs[pointer+1][1]=diffs[pointer-1][1]+diffs[pointer+1][1];diffs.splice(pointer-1,1);changes=true}else if(diffs[pointer][1].substring(0,diffs[pointer+1][1].length)==diffs[pointer+1][1]){diffs[pointer-1][1]+=diffs[pointer+1][1];diffs[pointer][1]=diffs[pointer][1].substring(diffs[pointer+1][1].length)+diffs[pointer+1][1];diffs.splice(pointer+1,1);changes=true}}pointer++}if(changes){this.diff_cleanupMerge(diffs)}};diff_match_patch.prototype.diff_xIndex=function(diffs,loc){var chars1=0;var chars2=0;var last_chars1=0;var last_chars2=0;var x;for(x=0;x<diffs.length;x++){if(diffs[x][0]!==DIFF_INSERT){chars1+=diffs[x][1].length}if(diffs[x][0]!==DIFF_DELETE){chars2+=diffs[x][1].length}if(chars1>loc){break}last_chars1=chars1;last_chars2=chars2}if(diffs.length!=x&&diffs[x][0]===DIFF_DELETE){return last_chars2}return last_chars2+(loc-last_chars1)};diff_match_patch.prototype.diff_prettyHtml=function(diffs){var html=[];var pattern_amp=/&/g;var pattern_lt=/</g;var pattern_gt=/>/g;var pattern_para=/\n/g;for(var x=0;x<diffs.length;x++){var op=diffs[x][0];var data=diffs[x][1];var text=data.replace(pattern_amp,"&amp;").replace(pattern_lt,"&lt;").replace(pattern_gt,"&gt;").replace(pattern_para,"&para;<br>");switch(op){case DIFF_INSERT:html[x]='<ins style="background:#e6ffe6;">'+text+"</ins>";break;case DIFF_DELETE:html[x]='<del style="background:#ffe6e6;">'+text+"</del>";break;case DIFF_EQUAL:html[x]="<span>"+text+"</span>";break}}return html.join("")};diff_match_patch.prototype.diff_text1=function(diffs){var text=[];for(var x=0;x<diffs.length;x++){if(diffs[x][0]!==DIFF_INSERT){text[x]=diffs[x][1]}}return text.join("")};diff_match_patch.prototype.diff_text2=function(diffs){var text=[];for(var x=0;x<diffs.length;x++){if(diffs[x][0]!==DIFF_DELETE){text[x]=diffs[x][1]}}return text.join("")};diff_match_patch.prototype.diff_levenshtein=function(diffs){var levenshtein=0;var insertions=0;var deletions=0;for(var x=0;x<diffs.length;x++){var op=diffs[x][0];var data=diffs[x][1];switch(op){case DIFF_INSERT:insertions+=data.length;break;case DIFF_DELETE:deletions+=data.length;break;case DIFF_EQUAL:levenshtein+=Math.max(insertions,deletions);insertions=0;deletions=0;break}}levenshtein+=Math.max(insertions,deletions);return levenshtein};diff_match_patch.prototype.diff_toDelta=function(diffs){var text=[];for(var x=0;x<diffs.length;x++){switch(diffs[x][0]){case DIFF_INSERT:text[x]="+"+encodeURI(diffs[x][1]);break;case DIFF_DELETE:text[x]="-"+diffs[x][1].length;break;case DIFF_EQUAL:text[x]="="+diffs[x][1].length;break}}return text.join("	").replace(/%20/g," ")};diff_match_patch.prototype.diff_fromDelta=function(text1,delta){var diffs=[];var diffsLength=0;var pointer=0;var tokens=delta.split(/\t/g);for(var x=0;x<tokens.length;x++){var param=tokens[x].substring(1);switch(tokens[x].charAt(0)){case"+":try{diffs[diffsLength++]=[DIFF_INSERT,decodeURI(param)]}catch(ex){throw new Error("Illegal escape in diff_fromDelta: "+param)}break;case"-":case"=":var n=parseInt(param,10);if(isNaN(n)||n<0){throw new Error("Invalid number in diff_fromDelta: "+param)}var text=text1.substring(pointer,pointer+=n);if(tokens[x].charAt(0)=="="){diffs[diffsLength++]=[DIFF_EQUAL,text]}else{diffs[diffsLength++]=[DIFF_DELETE,text]}break;default:if(tokens[x]){throw new Error("Invalid diff operation in diff_fromDelta: "+tokens[x])}}}if(pointer!=text1.length){throw new Error("Delta length ("+pointer+") does not equal source text length ("+text1.length+").")}return diffs};diff_match_patch.prototype.match_main=function(text,pattern,loc){if(text==null||pattern==null||loc==null){throw new Error("Null input. (match_main)")}loc=Math.max(0,Math.min(loc,text.length));if(text==pattern){return 0}else if(!text.length){return-1}else if(text.substring(loc,loc+pattern.length)==pattern){return loc}else{return this.match_bitap_(text,pattern,loc)}};diff_match_patch.prototype.match_bitap_=function(text,pattern,loc){if(pattern.length>this.Match_MaxBits){throw new Error("Pattern too long for this browser.")}var s=this.match_alphabet_(pattern);var dmp=this;function match_bitapScore_(e,x){var accuracy=e/pattern.length;var proximity=Math.abs(loc-x);if(!dmp.Match_Distance){return proximity?1:accuracy}return accuracy+proximity/dmp.Match_Distance}var score_threshold=this.Match_Threshold;var best_loc=text.indexOf(pattern,loc);if(best_loc!=-1){score_threshold=Math.min(match_bitapScore_(0,best_loc),score_threshold);best_loc=text.lastIndexOf(pattern,loc+pattern.length);if(best_loc!=-1){score_threshold=Math.min(match_bitapScore_(0,best_loc),score_threshold)}}var matchmask=1<<pattern.length-1;best_loc=-1;var bin_min,bin_mid;var bin_max=pattern.length+text.length;var last_rd;for(var d=0;d<pattern.length;d++){bin_min=0;bin_mid=bin_max;while(bin_min<bin_mid){if(match_bitapScore_(d,loc+bin_mid)<=score_threshold){bin_min=bin_mid}else{bin_max=bin_mid}bin_mid=Math.floor((bin_max-bin_min)/2+bin_min)}bin_max=bin_mid;var start=Math.max(1,loc-bin_mid+1);var finish=Math.min(loc+bin_mid,text.length)+pattern.length;var rd=Array(finish+2);rd[finish+1]=(1<<d)-1;for(var j=finish;j>=start;j--){var charMatch=s[text.charAt(j-1)];if(d===0){rd[j]=(rd[j+1]<<1|1)&charMatch}else{rd[j]=(rd[j+1]<<1|1)&charMatch|((last_rd[j+1]|last_rd[j])<<1|1)|last_rd[j+1]}if(rd[j]&matchmask){var score=match_bitapScore_(d,j-1);if(score<=score_threshold){score_threshold=score;best_loc=j-1;if(best_loc>loc){start=Math.max(1,2*loc-best_loc)}else{break}}}}if(match_bitapScore_(d+1,loc)>score_threshold){break}last_rd=rd}return best_loc};diff_match_patch.prototype.match_alphabet_=function(pattern){var s={};for(var i=0;i<pattern.length;i++){s[pattern.charAt(i)]=0}for(var i=0;i<pattern.length;i++){s[pattern.charAt(i)]|=1<<pattern.length-i-1}return s};diff_match_patch.prototype.patch_addContext_=function(patch,text){if(text.length==0){return}var pattern=text.substring(patch.start2,patch.start2+patch.length1);var padding=0;while(text.indexOf(pattern)!=text.lastIndexOf(pattern)&&pattern.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin){padding+=this.Patch_Margin;pattern=text.substring(patch.start2-padding,patch.start2+patch.length1+padding)}padding+=this.Patch_Margin;var prefix=text.substring(patch.start2-padding,patch.start2);if(prefix){patch.diffs.unshift([DIFF_EQUAL,prefix])}var suffix=text.substring(patch.start2+patch.length1,patch.start2+patch.length1+padding);if(suffix){patch.diffs.push([DIFF_EQUAL,suffix])}patch.start1-=prefix.length;patch.start2-=prefix.length;patch.length1+=prefix.length+suffix.length;patch.length2+=prefix.length+suffix.length};diff_match_patch.prototype.patch_make=function(a,opt_b,opt_c){var text1,diffs;if(typeof a=="string"&&typeof opt_b=="string"&&typeof opt_c=="undefined"){text1=a;diffs=this.diff_main(text1,opt_b,true);if(diffs.length>2){this.diff_cleanupSemantic(diffs);this.diff_cleanupEfficiency(diffs)}}else if(a&&typeof a=="object"&&typeof opt_b=="undefined"&&typeof opt_c=="undefined"){diffs=a;text1=this.diff_text1(diffs)}else if(typeof a=="string"&&opt_b&&typeof opt_b=="object"&&typeof opt_c=="undefined"){text1=a;diffs=opt_b}else if(typeof a=="string"&&typeof opt_b=="string"&&opt_c&&typeof opt_c=="object"){text1=a;diffs=opt_c}else{throw new Error("Unknown call format to patch_make.")}if(diffs.length===0){return[]}var patches=[];var patch=new diff_match_patch.patch_obj;var patchDiffLength=0;var char_count1=0;var char_count2=0;var prepatch_text=text1;var postpatch_text=text1;for(var x=0;x<diffs.length;x++){var diff_type=diffs[x][0];var diff_text=diffs[x][1];if(!patchDiffLength&&diff_type!==DIFF_EQUAL){patch.start1=char_count1;patch.start2=char_count2}switch(diff_type){case DIFF_INSERT:patch.diffs[patchDiffLength++]=diffs[x];patch.length2+=diff_text.length;postpatch_text=postpatch_text.substring(0,char_count2)+diff_text+postpatch_text.substring(char_count2);break;case DIFF_DELETE:patch.length1+=diff_text.length;patch.diffs[patchDiffLength++]=diffs[x];postpatch_text=postpatch_text.substring(0,char_count2)+postpatch_text.substring(char_count2+diff_text.length);break;case DIFF_EQUAL:if(diff_text.length<=2*this.Patch_Margin&&patchDiffLength&&diffs.length!=x+1){patch.diffs[patchDiffLength++]=diffs[x];patch.length1+=diff_text.length;patch.length2+=diff_text.length}else if(diff_text.length>=2*this.Patch_Margin){if(patchDiffLength){this.patch_addContext_(patch,prepatch_text);patches.push(patch);patch=new diff_match_patch.patch_obj;patchDiffLength=0;prepatch_text=postpatch_text;char_count1=char_count2}}break}if(diff_type!==DIFF_INSERT){char_count1+=diff_text.length}if(diff_type!==DIFF_DELETE){char_count2+=diff_text.length}}if(patchDiffLength){this.patch_addContext_(patch,prepatch_text);patches.push(patch)}return patches};diff_match_patch.prototype.patch_deepCopy=function(patches){var patchesCopy=[];for(var x=0;x<patches.length;x++){var patch=patches[x];var patchCopy=new diff_match_patch.patch_obj;patchCopy.diffs=[];for(var y=0;y<patch.diffs.length;y++){patchCopy.diffs[y]=patch.diffs[y].slice()}patchCopy.start1=patch.start1;patchCopy.start2=patch.start2;patchCopy.length1=patch.length1;patchCopy.length2=patch.length2;patchesCopy[x]=patchCopy}return patchesCopy};diff_match_patch.prototype.patch_apply=function(patches,text){if(patches.length==0){return[text,[]]}patches=this.patch_deepCopy(patches);var nullPadding=this.patch_addPadding(patches);text=nullPadding+text+nullPadding;this.patch_splitMax(patches);var delta=0;var results=[];for(var x=0;x<patches.length;x++){var expected_loc=patches[x].start2+delta;var text1=this.diff_text1(patches[x].diffs);var start_loc;var end_loc=-1;if(text1.length>this.Match_MaxBits){start_loc=this.match_main(text,text1.substring(0,this.Match_MaxBits),expected_loc);if(start_loc!=-1){end_loc=this.match_main(text,text1.substring(text1.length-this.Match_MaxBits),expected_loc+text1.length-this.Match_MaxBits);if(end_loc==-1||start_loc>=end_loc){start_loc=-1}}}else{start_loc=this.match_main(text,text1,expected_loc)}if(start_loc==-1){results[x]=false;delta-=patches[x].length2-patches[x].length1}else{results[x]=true;delta=start_loc-expected_loc;var text2;if(end_loc==-1){text2=text.substring(start_loc,start_loc+text1.length)}else{text2=text.substring(start_loc,end_loc+this.Match_MaxBits)}if(text1==text2){text=text.substring(0,start_loc)+this.diff_text2(patches[x].diffs)+text.substring(start_loc+text1.length)}else{var diffs=this.diff_main(text1,text2,false);if(text1.length>this.Match_MaxBits&&this.diff_levenshtein(diffs)/text1.length>this.Patch_DeleteThreshold){results[x]=false}else{this.diff_cleanupSemanticLossless(diffs);var index1=0;var index2;for(var y=0;y<patches[x].diffs.length;y++){var mod=patches[x].diffs[y];if(mod[0]!==DIFF_EQUAL){index2=this.diff_xIndex(diffs,index1)}if(mod[0]===DIFF_INSERT){text=text.substring(0,start_loc+index2)+mod[1]+text.substring(start_loc+index2)}else if(mod[0]===DIFF_DELETE){text=text.substring(0,start_loc+index2)+text.substring(start_loc+this.diff_xIndex(diffs,index1+mod[1].length))}if(mod[0]!==DIFF_DELETE){index1+=mod[1].length}}}}}}text=text.substring(nullPadding.length,text.length-nullPadding.length);return[text,results]};diff_match_patch.prototype.patch_addPadding=function(patches){var paddingLength=this.Patch_Margin;var nullPadding="";for(var x=1;x<=paddingLength;x++){nullPadding+=String.fromCharCode(x)}for(var x=0;x<patches.length;x++){patches[x].start1+=paddingLength;patches[x].start2+=paddingLength}var patch=patches[0];var diffs=patch.diffs;if(diffs.length==0||diffs[0][0]!=DIFF_EQUAL){diffs.unshift([DIFF_EQUAL,nullPadding]);patch.start1-=paddingLength;patch.start2-=paddingLength;patch.length1+=paddingLength;patch.length2+=paddingLength}else if(paddingLength>diffs[0][1].length){var extraLength=paddingLength-diffs[0][1].length;diffs[0][1]=nullPadding.substring(diffs[0][1].length)+diffs[0][1];patch.start1-=extraLength;patch.start2-=extraLength;patch.length1+=extraLength;patch.length2+=extraLength}patch=patches[patches.length-1];diffs=patch.diffs;if(diffs.length==0||diffs[diffs.length-1][0]!=DIFF_EQUAL){diffs.push([DIFF_EQUAL,nullPadding]);patch.length1+=paddingLength;patch.length2+=paddingLength}else if(paddingLength>diffs[diffs.length-1][1].length){var extraLength=paddingLength-diffs[diffs.length-1][1].length;diffs[diffs.length-1][1]+=nullPadding.substring(0,extraLength);patch.length1+=extraLength;patch.length2+=extraLength}return nullPadding};diff_match_patch.prototype.patch_splitMax=function(patches){var patch_size=this.Match_MaxBits;for(var x=0;x<patches.length;x++){if(patches[x].length1<=patch_size){continue}var bigpatch=patches[x];patches.splice(x--,1);var start1=bigpatch.start1;var start2=bigpatch.start2;var precontext="";while(bigpatch.diffs.length!==0){var patch=new diff_match_patch.patch_obj;var empty=true;patch.start1=start1-precontext.length;patch.start2=start2-precontext.length;if(precontext!==""){patch.length1=patch.length2=precontext.length;patch.diffs.push([DIFF_EQUAL,precontext])}while(bigpatch.diffs.length!==0&&patch.length1<patch_size-this.Patch_Margin){var diff_type=bigpatch.diffs[0][0];var diff_text=bigpatch.diffs[0][1];if(diff_type===DIFF_INSERT){patch.length2+=diff_text.length;start2+=diff_text.length;patch.diffs.push(bigpatch.diffs.shift());empty=false}else if(diff_type===DIFF_DELETE&&patch.diffs.length==1&&patch.diffs[0][0]==DIFF_EQUAL&&diff_text.length>2*patch_size){patch.length1+=diff_text.length;start1+=diff_text.length;empty=false;patch.diffs.push([diff_type,diff_text]);bigpatch.diffs.shift()}else{diff_text=diff_text.substring(0,patch_size-patch.length1-this.Patch_Margin);patch.length1+=diff_text.length;start1+=diff_text.length;if(diff_type===DIFF_EQUAL){patch.length2+=diff_text.length;start2+=diff_text.length}else{empty=false}patch.diffs.push([diff_type,diff_text]);if(diff_text==bigpatch.diffs[0][1]){bigpatch.diffs.shift()}else{bigpatch.diffs[0][1]=bigpatch.diffs[0][1].substring(diff_text.length)}}}precontext=this.diff_text2(patch.diffs);precontext=precontext.substring(precontext.length-this.Patch_Margin);
var postcontext=this.diff_text1(bigpatch.diffs).substring(0,this.Patch_Margin);if(postcontext!==""){patch.length1+=postcontext.length;patch.length2+=postcontext.length;if(patch.diffs.length!==0&&patch.diffs[patch.diffs.length-1][0]===DIFF_EQUAL){patch.diffs[patch.diffs.length-1][1]+=postcontext}else{patch.diffs.push([DIFF_EQUAL,postcontext])}}if(!empty){patches.splice(++x,0,patch)}}}};diff_match_patch.prototype.patch_toText=function(patches){var text=[];for(var x=0;x<patches.length;x++){text[x]=patches[x]}return text.join("")};diff_match_patch.prototype.patch_fromText=function(textline){var patches=[];if(!textline){return patches}var text=textline.split("\n");var textPointer=0;var patchHeader=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;while(textPointer<text.length){var m=text[textPointer].match(patchHeader);if(!m){throw new Error("Invalid patch string: "+text[textPointer])}var patch=new diff_match_patch.patch_obj;patches.push(patch);patch.start1=parseInt(m[1],10);if(m[2]===""){patch.start1--;patch.length1=1}else if(m[2]=="0"){patch.length1=0}else{patch.start1--;patch.length1=parseInt(m[2],10)}patch.start2=parseInt(m[3],10);if(m[4]===""){patch.start2--;patch.length2=1}else if(m[4]=="0"){patch.length2=0}else{patch.start2--;patch.length2=parseInt(m[4],10)}textPointer++;while(textPointer<text.length){var sign=text[textPointer].charAt(0);try{var line=decodeURI(text[textPointer].substring(1))}catch(ex){throw new Error("Illegal escape in patch_fromText: "+line)}if(sign=="-"){patch.diffs.push([DIFF_DELETE,line])}else if(sign=="+"){patch.diffs.push([DIFF_INSERT,line])}else if(sign==" "){patch.diffs.push([DIFF_EQUAL,line])}else if(sign=="@"){break}else if(sign===""){}else{throw new Error('Invalid patch mode "'+sign+'" in: '+line)}textPointer++}}return patches};diff_match_patch.patch_obj=function(){this.diffs=[];this.start1=null;this.start2=null;this.length1=0;this.length2=0};diff_match_patch.patch_obj.prototype.toString=function(){var coords1,coords2;if(this.length1===0){coords1=this.start1+",0"}else if(this.length1==1){coords1=this.start1+1}else{coords1=this.start1+1+","+this.length1}if(this.length2===0){coords2=this.start2+",0"}else if(this.length2==1){coords2=this.start2+1}else{coords2=this.start2+1+","+this.length2}var text=["@@ -"+coords1+" +"+coords2+" @@\n"];var op;for(var x=0;x<this.diffs.length;x++){switch(this.diffs[x][0]){case DIFF_INSERT:op="+";break;case DIFF_DELETE:op="-";break;case DIFF_EQUAL:op=" ";break}text[x+1]=op+encodeURI(this.diffs[x][1])+"\n"}return text.join("").replace(/%20/g," ")};IBTX.thirdParty.diff_match_patch=diff_match_patch})();IBTX.Hlp.diff=function(){"use strict";var priv,pub;priv={obj:new IBTX.thirdParty.diff_match_patch,diff:function(text1,text2){return priv.obj.diff_main(text1,text2)},diffCleanupSemantic:function(diffs){return priv.obj.diff_cleanupSemantic(diffs)},diffCleanupEfficiency:function(diffs){return priv.obj.diff_cleanupEfficiency(diffs)},diffLevenshtein:function(diffs){return priv.obj.diff_levenshtein(diffs)},diffPrettyHtml:function(diffs){return priv.obj.diff_prettyHtml(diffs)},match:function(text,pattern,loc){return priv.obj.match_main(text,pattern,loc)},patchMake:function(a,opt_b){var res=null;if(a&&typeof a==="string"&&opt_b&&typeof opt_b==="string"){res=priv.obj.patch_make(a,opt_b)}else if(a&&typeof a==="object"&&opt_b===undefined){res=priv.obj.patch_make(a)}else if(a&&typeof a==="string"&&opt_b&&typeof opt_b==="object"){res=priv.obj.patch_make(a,opt_b)}return res},patchToText:function(patches){return priv.obj.patch_toText(patches)},patchFromText:function(text){return priv.obj.patch_fromText(text)},patchApply:function(patches,text1){return priv.obj.patch_apply(patches,text1)}};pub={diff:priv.diff,diffCleanupSemantic:priv.diffCleanupSemantic,diffCleanupEfficiency:priv.diffCleanupEfficiency,diffLevenshtein:priv.diffLevenshtein,diffPrettyHtml:priv.diffPrettyHtml,match:priv.match,patchMake:priv.patchMake,patchToText:priv.patchToText,patchFromText:priv.patchFromText,patchApply:priv.patchApply};return pub}();IBTX.Mod.Obj.TypingSim=function($){"use strict";var konst={},statik={},Obj;konst={KEY_PRESS_RATE_CALC:95,DIFF_DELETE:-1,DIFF_INSERT:1,DIFF_EQUAL:0,EVT_START_PROCESSING:"startProcessing",EVT_OP_DEL_CONTINUE_RECUR:"opDelContinueRecur",EVT_OP_DEL_DONE:"opDelDone",EVT_OP_INS_CONTINUE_RECUR:"opInsContinueRecur",EVT_OP_INS_DONE:"opInsDone",EVT_OP_EQ_DONE:"opEqDone",EVT_OP_STOPPED:"opStopped",CURSOR_HTML:'<div class="{cssClass} cursor-s" style="border-right: solid 1px black; position: absolute; height: {height}px;"></div>',CURSOR_CSS_CLASS:"cursor",CURSOR_CSS_CLASS_SHOW:"cursor-s",CURSOR_CSS_CLASS_HIDE:"cursor-h",CURSOR_SHOW:true,CURSOR_BLINK_RATE:550,CURSOR_BLINK_AT_STOP_FOR_MS:550*10,HTML_NEEDLE:/&[a-z0-9A-Z]+;/};statik.getSplitByHtmlEntities=function(haystacks){var h,haystack,ret=[],fromAft,toBef,rio;for(h=0;h<haystacks.length;h+=1){haystack=haystacks[h][1];while(haystack.length){rio=IBTX.Hlp.string.regexIndexOf(haystack,new RegExp("[ƀ-Ǝ]","g"));if(rio.index===0){fromAft=rio.match.length;toBef=rio.match.length}else if(rio.index===-1){fromAft=haystack.length;toBef=haystack.length}else{fromAft=rio.index;toBef=rio.index}ret.push([haystacks[h][0],haystack.substring(0,toBef)]);haystack=haystack.substring(fromAft)}}return ret};statik.getMappedHtmlEntities=function(){var map={},rio,key,value,valueC=384,args,h,haystack,from,to;args=Array.prototype.slice.call(arguments);for(h=0;h<args.length;h+=1){haystack=args[h];while(haystack.length){rio=IBTX.Hlp.string.regexIndexOf(haystack,konst.HTML_NEEDLE);if(rio.index===-1){break}from=rio.index;to=rio.index+rio.match.length;key=String.fromCharCode(valueC);value=haystack.substring(from,to);if(!map[key]){if(valueC>384+14){throw new Error("too many HTML entities")}map[key]=value;valueC+=1}haystack=haystack.substring(to).replace(new RegExp(value,"g"),key)}}return map};statik.getConvertedUsingMap=function(map,string){var key;for(key in map){if(map.hasOwnProperty(key)){string=string.replace(new RegExp(map[key],"g"),key)}}return string};statik.getUnmappedHtmlEntities=function(map,haystack){var trans=haystack,key;for(key in map){if(map.hasOwnProperty(key)){trans=trans.replace(new RegExp(key,"g"),map[key])}}return trans};statik.getRemappedHtmlEntities=function(map,diffs){var i,key;for(key in map){if(map.hasOwnProperty(key)){for(i=0;i<diffs.length;i+=1){if(diffs[i][1].match(key)){diffs[i][1]=diffs[i][1].replace(new RegExp(key,"g"),map[key])}}}}return diffs};Obj=function(){var that=IBTX.Core.merge(this,new IBTX.Core.Obj.EventEmitter);that.setMaxListeners(0);that.data={askToStop:false,askToRestart:false,isTyping:false,diff:{inpWhole:undefined,inpSingle:undefined,outp:undefined,diffs:undefined,idx:undefined,from:undefined,len:undefined,to:undefined,op:undefined,proc:undefined},input:"",output:"",timer:{t:{id:undefined,setAt:0,remaining:0,howLong:0,active:false},b:{id:undefined,setAt:0,remaining:0,howLong:0,active:false},p:{id:undefined,setAt:0,remaining:0,howLong:0,active:false}}};that.on(konst.EVT_START_PROCESSING,function(){if(!that.data.isTyping){that.disposeOfTimers();that.shouldContinue(function(){that.procDiff()})}});that.on(konst.EVT_OP_DEL_CONTINUE_RECUR,function(){that.shouldContinue(that.getSetRandTimeout(function(){that.recurDel()},.6))});that.on(konst.EVT_OP_DEL_DONE,function(){that.shouldContinue(that.getSetRandTimeout(function(){that.procDiff()},1.5))});that.on(konst.EVT_OP_INS_CONTINUE_RECUR,function(){that.shouldContinue(that.getSetRandTimeout(function(){that.recurIns()}))});that.on(konst.EVT_OP_INS_DONE,function(){that.shouldContinue(that.getSetRandTimeout(function(){that.procDiff()},1.5))});that.on(konst.EVT_OP_EQ_DONE,function(){that.shouldContinue(function(){that.procDiff()})});return that};Obj.prototype.getSetRandTimeout=function(cb,optMult){var that=this,mult=optMult!==undefined?optMult:1,ret,keyPressRate=konst.KEY_PRESS_RATE_CALC,wait;wait=(keyPressRate/5*.95+Math.random()*keyPressRate*5*(1-.95)+keyPressRate/5*.9+Math.random()*keyPressRate*5*(1-.9)+keyPressRate/5*.85+Math.random()*keyPressRate*5*(1-.85)+keyPressRate/5*.8+Math.random()*keyPressRate*5*(1-.8)+keyPressRate/5*.75+Math.random()*keyPressRate*5*(1-.75))*mult*.7;ret=function(){if(mult>=0){that.data.timer.t=setTimeout(cb,parseInt(wait,10)*that.data.diff.forceDelay)}};return ret};Obj.prototype.getHtmlWithoutCursor=function(){var that=this,withoutCursor=that.data.output;if(konst.CURSOR_SHOW){withoutCursor=that.data.output.clone();withoutCursor.find(IBTX.Hlp.string.format(".{cssClass}",{cssClass:konst.CURSOR_CSS_CLASS})).remove()}return withoutCursor.html()};Obj.prototype.cursorRemove=function(){var that=this;if(konst.CURSOR_SHOW){that.data.output.find(IBTX.Hlp.string.format(".{cssClass}",{cssClass:konst.CURSOR_CSS_CLASS})).remove()}};Obj.prototype.cursorBlinkThenHide=function(){var that=this,show=false,addClass,removeClass;if(konst.CURSOR_SHOW){(function repeat(blinkTtl){blinkTtl-=konst.CURSOR_BLINK_RATE;if(show){addClass=konst.CURSOR_CSS_CLASS_SHOW;removeClass=konst.CURSOR_CSS_CLASS_HIDE}else{addClass=konst.CURSOR_CSS_CLASS_HIDE;removeClass=konst.CURSOR_CSS_CLASS_SHOW}that.data.output.find(IBTX.Hlp.string.format(".{cssClass}",{cssClass:konst.CURSOR_CSS_CLASS})).addClass(addClass).removeClass(removeClass);if(blinkTtl>0){clearTimeout(that.data.timer.b);that.data.timer.b=setTimeout(function(){repeat(blinkTtl)},konst.CURSOR_BLINK_RATE)}else{that.data.output.find(IBTX.Hlp.string.format(".{cssClass}",{cssClass:konst.CURSOR_CSS_CLASS})).addClass(konst.CURSOR_CSS_CLASS_HIDE).removeClass(konst.CURSOR_CSS_CLASS_SHOW)}show=!show})(konst.CURSOR_BLINK_AT_STOP_FOR_MS)}};Obj.prototype.cursorPrepareToBlink=function(){var that=this;clearTimeout(that.data.timer.p);that.data.timer.p=setTimeout(function(){that.cursorBlinkThenHide()},konst.CURSOR_BLINK_RATE)};Obj.prototype.getPlacedCursor=function(){var that=this,index=that.data.diff.from,cursorHeight=Math.ceil(parseInt(that.data.output.css("line-height"),10)/2)+Math.ceil(parseInt(that.data.output.css("font-size"),10)/2)+2,cursor=$(IBTX.Hlp.string.format(konst.CURSOR_HTML,{cssClass:konst.CURSOR_CSS_CLASS,height:cursorHeight.toString()})),cursorOuterHtml,cursorClone,html=that.data.diff.outp,ret;if(konst.CURSOR_SHOW&&that.data.diff.forceDelay){cursorClone=cursor.clone();if(that.data.diff.op===konst.DIFF_INSERT&&html[that.data.diff.from-1]===" "){if(that.data.diff.to===that.data.diff.inpWhole.length){cursorClone.html("&nbsp;")}}cursorOuterHtml=cursorClone[0].outerHTML;that.data.output.html(html.slice(0,index)+cursorOuterHtml+html.slice(index));ret={htmlWithCursor:that.data.output.html(),indexAfterCursor:cursorOuterHtml.length+index}}else{ret={htmlWithCursor:that.data.output.html(),indexAfterCursor:index}}return ret};Obj.prototype.start=function(input,output){var that=this;that.data.askToRestart=true;that.data.input=input;that.data.output=output;that.emit(konst.EVT_START_PROCESSING)};Obj.prototype.stop=function(){var that=this;that.data.askToStop=true;that.disposeOfTimers()};Obj.prototype.restart=function(input,output){var that=this;that.start(input,output)};Obj.prototype.isTyping=function(){var that=this;return that.data.isTyping};Obj.prototype.disposeOfTimers=function(){var that=this;clearTimeout(that.data.timer.t);if(konst.CURSOR_SHOW){clearTimeout(that.data.timer.b);clearTimeout(that.data.timer.p)}};Obj.prototype.shouldContinue=function(cb){var that=this,shouldContinue=true;if(that.data.askToStop){that.data.askToStop=false;shouldContinue=false}else if(that.data.askToRestart){that.data.askToRestart=false;that.resetDiff()}if(shouldContinue){that.data.isTyping=true;cb()}else{return that.stopExec()}return shouldContinue};Obj.prototype.procDiff=function(){var that=this,arElm,op,htmlEntMap;that.data.diff.inpWhole=that.data.diff.inpWhole||$("<div>"+that.data.input+"</div>").html();that.data.diff.outp=that.getHtmlWithoutCursor();htmlEntMap=statik.getMappedHtmlEntities(that.data.diff.inpWhole,that.data.diff.outp);that.data.diff.inpWhole=statik.getConvertedUsingMap(htmlEntMap,that.data.diff.inpWhole);that.data.diff.outp=statik.getConvertedUsingMap(htmlEntMap,that.data.diff.outp);that.data.diff.diffs=that.data.diff.diffs||statik.getSplitByHtmlEntities(IBTX.Hlp.diff.diff(that.data.diff.outp,that.data.diff.inpWhole));that.data.diff.diffs=statik.getRemappedHtmlEntities(htmlEntMap,that.data.diff.diffs);that.data.diff.idx=that.data.diff.idx||0;that.data.diff.inpWhole=statik.getUnmappedHtmlEntities(htmlEntMap,that.data.diff.inpWhole);that.data.diff.outp=statik.getUnmappedHtmlEntities(htmlEntMap,that.data.diff.outp);if(!that.data.diff.diffs||!(that.data.diff.diffs.length>0)){that.stopExec()}else{arElm=that.data.diff.diffs.shift();op=arElm[0];that.data.diff.op=op;that.data.diff.inpSingle=arElm[1];that.data.diff.forceDelay=1;if(IBTX.Hlp.string.trim(that.data.diff.inpSingle).length===0){that.data.diff.forceDelay=0}that.data.diff.from=that.data.diff.idx;that.data.diff.len=arElm[1].length;if(op!==konst.DIFF_DELETE){that.data.diff.idx+=that.data.diff.len}that.data.diff.to=that.data.diff.idx;switch(op){case konst.DIFF_DELETE:that.recurDel();break;case konst.DIFF_INSERT:that.recurIns();break;case konst.DIFF_EQUAL:that.emit(konst.EVT_OP_EQ_DONE);break}}};Obj.prototype.stopExec=function(){var that=this;that.data.isTyping=false;that.disposeOfTimers();if(that.data.diff.proc){that.getPlacedCursor();that.cursorBlinkThenHide()}that.emit(konst.EVT_OP_STOPPED)};Obj.prototype.recurDel=function(){var that=this,aftOp;that.data.diff.proc=true;if(that.data.diff.len>0){if(!that.data.askToRestart){that.cursorRemove();that.data.diff.outp=that.getHtmlWithoutCursor();aftOp=that.getPlacedCursor();if(!that.data.diff.diffs||!(that.data.diff.diffs.length>0)){that.cursorPrepareToBlink()}if(IBTX.Hlp.string.regexIndexOf(that.data.diff.inpSingle,konst.HTML_NEEDLE).index!==-1){that.data.diff.outp=IBTX.Hlp.string.delChars(aftOp.htmlWithCursor,aftOp.indexAfterCursor,that.data.diff.inpSingle.length);that.data.diff.len-=that.data.diff.inpSingle.length}else{that.data.diff.outp=IBTX.Hlp.string.delChar(aftOp.htmlWithCursor,aftOp.indexAfterCursor);that.data.diff.len-=1}that.data.output.html(that.data.diff.outp)}that.emit(konst.EVT_OP_DEL_CONTINUE_RECUR)}else{that.emit(konst.EVT_OP_DEL_DONE)}};Obj.prototype.recurIns=function(){var that=this;that.data.diff.proc=true;if(that.data.diff.from<that.data.diff.to){if(!that.data.askToRestart){that.cursorRemove();that.data.diff.outp=that.getHtmlWithoutCursor();if(IBTX.Hlp.string.regexIndexOf(that.data.diff.inpSingle,konst.HTML_NEEDLE).index!==-1){that.data.diff.outp=IBTX.Hlp.string.insString(that.data.diff.outp,that.data.diff.from,that.data.diff.inpSingle);that.data.diff.from+=that.data.diff.inpSingle.length}else{that.data.diff.outp=IBTX.Hlp.string.insChar(that.data.diff.outp,that.data.diff.from,that.data.diff.inpWhole[that.data.diff.from]);that.data.diff.from+=1}that.data.output.html(that.data.diff.outp);that.getPlacedCursor();if(!that.data.diff.diffs||!(that.data.diff.diffs.length>0)){that.cursorPrepareToBlink()}}that.emit(konst.EVT_OP_INS_CONTINUE_RECUR)}else{that.emit(konst.EVT_OP_INS_DONE)}};Obj.prototype.resetDiff=function(){var that=this;that.data.diff.inpWhole=undefined;that.data.diff.inpSingle=undefined;that.data.diff.outp=undefined;that.data.diff.diffs=undefined;that.data.diff.idx=undefined;that.data.diff.from=undefined;that.data.diff.len=undefined;that.data.diff.to=undefined;that.data.diff.op=undefined;that.data.diff.proc=undefined};return Obj}(IBTX.jQuery);IBTX.Mod.typingSim=function(){"use strict";var TypingSim=IBTX.Mod.Obj.TypingSim,PersistenceFactory=IBTX.Core.Obj.PersistenceFactory,statik={},pub={};statik.typingSims=new PersistenceFactory(TypingSim);statik.get=function(id){return statik.typingSims.get(id)};pub={get:statik.get};return pub}();IBTX.App.view["livecoverage"]="<div>"+'    <div class="rt-livecoverage-item-head">'+'        <span class="rt-livecoverage-item-created-at">{{{item-created-at}}}</span><span class="rt-livecoverage-item-created-by">{{{item-created-by}}}</span>'+'        <span class="rt-livecoverage-item-updated-at">{{{item-updated-at}}}</span><span class="rt-livecoverage-item-updated-by">{{{item-updated-by}}}</span>'+"    </div>"+'    <div class="rt-livecoverage-item-text">{{{item-text}}}</div>'+'    <div class="rt-livecoverage-item-pub-status">{{{item-pub-status}}}</div>'+"</div>";IBTX.App.Obj.LiveCoverage=function($){"use strict";var statik={},Obj,strFormat=IBTX.Hlp.string.format,mapP=IBTX.Hlp.object.mapProperties,filter=IBTX.Hlp.object.filter,AbstractApp=IBTX.Core.Obj.AbstractApp,GET=IBTX.Mod.ortcRest.GET,realtime=IBTX.Mod.realtime,error=IBTX.Mod.debug.error,fwCfg=IBTX.Cfg.main;statik.mapForItemData={itemId:"item-id",text:"item-text",pubStatus:"item-pub-status",createdAt:"item-created-at",createdBy:"item-created-by",updatedAt:"item-updated-at",updatedBy:"item-updated-by"};statik.filterForItemMeta=["liveId"];Obj=function(){var that=this;that.cfg={};return AbstractApp.apply(that,arguments)};Obj.prototype=new AbstractApp;Obj.prototype._start=function(){var that=this;if(that.cfg.id){GET(strFormat("{apiUri}/live-coverages/{liveId}/items/?api_key={apiKey}",{apiUri:fwCfg.apiUri.liveCoverage,liveId:that.cfg.id,apiKey:fwCfg.apiKey}),function(err,response){if(!err){if(response){response._records.forEach(that.runRenderHooks.bind(that))}realtime.whenConnected(function(){realtime.subscribe(strFormat("livecoverages:##",that.cfg.id));realtime.on(strFormat("message::livecoverages:##::update",that.cfg.id),that.runRenderHooks.bind(that));realtime.on(strFormat("message::livecoverages:##::delete",that.cfg.id),that.runDeleteHooks.bind(that))})}else{error(strFormat("error on dataReceived hook. err: ##",err))}})}};Obj.prototype._finish=function(){};Obj.prototype.runDataReceivedHook=function(update){var that=this,bUpdate={},bStore={};update._data=filter(update._data,Object.keys(statik.mapForItemData));update._meta=filter(update._meta,statik.filterForItemMeta);that.storeSet(update._data.itemId,update);bUpdate=that.storeGet(update._data.itemId);bStore=that.storeGet();that.storeSetJq(that.jq);that.storeGetJq().attr("data-rt-livecoverage-id",update._meta.liveId);that.hooks.run("dataReceived",bUpdate,bStore,function(err,userUpdate,userStore,preventDefaults){if(!err){if(!preventDefaults){that.storeSet(userUpdate._id,userUpdate);that.storeSet(userStore)}}else{error(strFormat("error on dataReceived hook. err: ##",err))}})};Obj.prototype.runRenderHooks=function(update){var that=this,bData={};that.runDataReceivedHook(update);bData=mapP(statik.mapForItemData,that.storeGetData(update._data.itemId));that.hooks.run("preRender",bData,function(err,userData,preventDefaults){var bHtmlNode,bData={},target,isNew=false;if(!err){if(!preventDefaults){target=that.storeGetJq(userData["item-id"]);if(!target){target=that.cfg.tpl.main;isNew=true}target=that.compileRenderJq(target,userData);if(isNew){that.jq.prepend(target)}target.attr("data-rt-livecoverage-item-id",userData["item-id"]);target.addClass("rt-livecoverage-item");bData=mapP(statik.mapForItemData,that.storeGetData(userData["item-id"]));that.storeSetJq(userData["item-id"],target);bHtmlNode=that.storeGetJq(userData["item-id"])[0];that.hooks.run("postRender",bHtmlNode,bData)}}else{error(strFormat("error on preRender hook. err: ##",err))}})};Obj.prototype.runDeleteHooks=function(update){var that=this,bHtmlNode,bData={};that.runDataReceivedHook(update);bHtmlNode=that.storeGetJq(update._data.itemId)[0];bData=mapP(statik.mapForItemData,that.storeGetData(update._data.itemId));that.hooks.run("preDelete",bHtmlNode,bData,function(err,userHtmlNode,userData,preventDefaults){if(!err){if(!preventDefaults){$(userHtmlNode).remove();that.storeDel(userData["item-id"])}}else{error(strFormat("error on preDelete hook. err: ##",err))}})};return Obj}(IBTX.jQuery);IBTX.App.liveCoverage=function(){"use strict";var Obj;Obj=function(){var that=this;return that};Obj.prototype=new IBTX.Core.Obj.AbstractAppController(IBTX.App.Obj.LiveCoverage,{appName:"livecoverage",optHooks:["preRender","postRender","preDelete","dataReceived"],optHTMLConfigs:{id:{name:"id",type:"string"}}});return new Obj}();IBTX.App.Obj.MoodMeter=function($){"use strict";var konst={},Obj;konst={ROUTE_MOODMETERS_ID:IBTX.Cfg.main.apiUri.moodMeter+"/mood-meters/{id}/?api_key={apiKey}",ROUTE_MOODMETERS_ID_VOTES:IBTX.Cfg.main.apiUri.moodMeter+"/mood-meters/{id}/votes/?api_key={apiKey}",APP_SELECTOR:".rt-moodmeter",APP_DATA_ATTR_ID:"data-rt-moodmeter-id",APP_DATA_ATTR_REF:"data-rt-moodmeter-ref",APP_DATA_ATTR_UPD_PROP:"data-rt-moodmeter-upd-prop",APP_CSS_SEL_LEFT_BTN:".vote-left",APP_CSS_SEL_RIGHT_BTN:".vote-right",APP_CSS_DEF_VOTE_CURSOR:"pointer",MSG_CHANNEL_FROM_SERVER:"moodmeters:{id}",MSG_ACTION_UPDATE:"moodmeters:update",MSG_SUBSCRIBER:"message::{channel}::{action}",REST_ERR_MSG:"{met} {path}: {status} - {error}",HOOK_PRERENDER:"preRender"};Obj=function(jqElm){var that=this,id=jqElm.attr(konst.APP_DATA_ATTR_ID),apiPath,ch;that=IBTX.Core.merge(that,new IBTX.Core.Obj.EventEmitter);that.data={id:id,jqElm:jqElm,leftBtn:jqElm.find(konst.APP_CSS_SEL_LEFT_BTN),rightBtn:jqElm.find(konst.APP_CSS_SEL_RIGHT_BTN)};that.data.leftBtn.css({cursor:konst.APP_CSS_DEF_VOTE_CURSOR});that.data.leftBtn.on("click",function(){that.regVote(true)});that.data.rightBtn.css({cursor:konst.APP_CSS_DEF_VOTE_CURSOR});that.data.rightBtn.on("click",function(){that.regVote(false)});apiPath=IBTX.Hlp.string.format(konst.ROUTE_MOODMETERS_ID,{id:that.data.id,apiKey:IBTX.Cfg.main.apiKey});IBTX.Mod.ortcRest.GET(apiPath,function(err,data){if(!err){that.handleSrvUpd(data)}else{IBTX.Mod.debug.error(IBTX.Hlp.string.format(konst.REST_ERR_MSG,{met:"GET",path:apiPath}))}});IBTX.Mod.realtime.whenConnected(function(){ch=IBTX.Hlp.string.format(konst.MSG_CHANNEL_FROM_SERVER,{id:that.data.id});IBTX.Mod.realtime.subscribe(ch);IBTX.Mod.realtime.on(IBTX.Hlp.string.format(konst.MSG_SUBSCRIBER,{channel:ch,action:konst.MSG_ACTION_UPDATE}),function(data){that.handleSrvUpd(data)})});return that};Obj.prototype.regVote=function(isLVote){var that=this,apiPath=IBTX.Hlp.string.format(konst.ROUTE_MOODMETERS_ID_VOTES,{id:that.data.id,apiKey:IBTX.Cfg.main.apiKey});IBTX.Mod.ortcRest.POST(apiPath,{uid:IBTX.Mod.user.konst.UID,isLVote:isLVote},function(err,data){if(!err){if(!IBTX.Mod.realtime.isConnected()){that.handleSrvUpd(data)}}else{IBTX.Mod.debug.error(IBTX.Hlp.string.format(konst.REST_ERR_MSG,{met:"POST",path:apiPath}))}})};Obj.prototype.updateReferences=function(data){var that=this,prop;for(prop in data){if(data.hasOwnProperty(prop)){$(IBTX.Hlp.string.format("[{dataAttrRef}={ref}][{dataAttrUpdProp}={prop}]",{dataAttrRef:konst.APP_DATA_ATTR_REF,ref:that.data.id,dataAttrUpdProp:konst.APP_DATA_ATTR_UPD_PROP,prop:prop})).html(data[prop])}}};Obj.prototype.handleSrvUpd=function(data){var that=this,hData;hData={trendLVotes:data._data.trendLVotes,trendRVotes:data._data.trendRVotes,allTimeLVotes:data._data.allTimeLVotes,allTimeRVotes:data._data.allTimeRVotes};that.hooks.run(konst.HOOK_PRERENDER,hData,function(err,rData){if(!err){that.updateReferences(rData)}else{IBTX.Mod.debug.error(IBTX.Hlp.string.format("error on {hook} hook. err: {err}",{hook:konst.HOOK_PRERENDER,err:err}))}})};Obj.prototype.bindHookManager=function(hookMan){var that=this;that.hooks=hookMan};Obj.konst={APP_SELECTOR:konst.APP_SELECTOR,HOOK_PRERENDER:konst.HOOK_PRERENDER};return Obj}(IBTX.jQuery);IBTX.App.moodMeter=function($){"use strict";var konst={},statik={},pub={};konst={CONTROLLER_DATA_ATTR_SEL_ID:"data-rt-moodmeter-sel-id"};statik.refs={len:0};statik.find=function(sel){var ret=[];$(IBTX.App.Obj.MoodMeter.konst.APP_SELECTOR+(sel||"")).each(function(){if(!$(this).attr(konst.CONTROLLER_DATA_ATTR_SEL_ID)){statik.refs.len+=1;$(this).attr(konst.CONTROLLER_DATA_ATTR_SEL_ID,statik.refs.len);statik.refs[statik.refs.len]={jqElm:$(this),hooks:new IBTX.Core.Obj.HookManager(IBTX.App.Obj.MoodMeter.konst.HOOK_PRERENDER)}}ret.push(statik.refs[$(this).attr(konst.CONTROLLER_DATA_ATTR_SEL_ID)])});return new IBTX.Hlp.Obj.Iterator(ret)};statik.each=function(cb){return statik.find().each(cb)};statik.start=function(){statik.find().each(function(ref){if(ref.jqElm){new IBTX.App.Obj.MoodMeter(ref.jqElm).bindHookManager(ref.hooks)}})};pub={find:statik.find,each:statik.each,start:statik.start};IBTX.once(IBTX.konst.EVT_FRAMEWORK_STARTED,statik.start);pub=IBTX.Core.merge(pub,new IBTX.Core.Obj.EventEmitter);return pub}(IBTX.jQuery);IBTX.App.Obj.Poll=function($){"use strict";var Obj,strFormat=IBTX.Hlp.string.format,GET=IBTX.Mod.ortcRest.GET,POST=IBTX.Mod.ortcRest.POST,fwCfg=IBTX.Cfg.main,realtime=IBTX.Mod.realtime,AbstractApp=IBTX.Core.Obj.AbstractApp;Obj=function(){var that=this;that.cfg={type:"direct"};return AbstractApp.apply(that,arguments)};Obj.prototype=new AbstractApp;Obj.prototype._start=function(){var that=this;that.itemsRefs=that.jq.find(".rt-poll-vote-ref");that.btn=that.jq.find(".rt-poll-vote-btn");that.btn.css({cursor:"pointer"});switch(that.cfg.type){case"list":that.btn.on("click.IBTX",function(){var votes=[];that.jq.find(".rt-poll-item:checked").each(function(){votes.push($(this).attr("data-rt-poll-item-id"))});that.postPollVotes(votes)});break;case"direct":that.jq.on("click.IBTX",".rt-poll-item",function(){var vote=$(this).attr("data-rt-poll-item-id");that.postPollVotes([vote])});break}realtime.whenConnected(function(){realtime.subscribe(strFormat("poll:##",that.cfg.id));realtime.on(strFormat("message::poll:##::poll:srvUpdate",that.cfg.id),function(votes){that.handleServerUpd(votes._data)})});that.getPollVotes()};Obj.prototype.getPollVotes=function(){var that=this,url=strFormat("{base}/polls/{id}/votes/?api_key={apiKey}",{base:fwCfg.apiUri.poll,id:that.cfg.id,apiKey:fwCfg.apiKey});GET(url,function(err,votes){votes=votes||{};that.handleServerUpd(votes._data||[])})};Obj.prototype.postPollVotes=function(votes){var that=this,url=strFormat("{base}/polls/{id}/votes/?api_key={apiKey}",{base:fwCfg.apiUri.poll,id:that.cfg.id,apiKey:fwCfg.apiKey});if(votes){POST(url,votes)}};Obj.prototype.handleServerUpd=function(votes){var that=this,i,updRefs;updRefs=function(id,n){var data={id:id,n:n};that.hooks.run("preRender",data,function(err,data,preventDefaults){if(!err){if(!preventDefaults){if(that.itemsRefs.length){that.itemsRefs.each(function(){if($(this).attr("data-rt-poll-vote-ref")===data.id){$(this).html(data.n)}})}}}})};for(i=0;i<votes.length;i+=1){updRefs(votes[i].id,votes[i].n+(that.cfg.minVotes||0))}};return Obj}(IBTX.jQuery);IBTX.App.poll=function(){"use strict";var Obj;Obj=function(){var that=this;return that};Obj.prototype=new IBTX.Core.Obj.AbstractAppController(IBTX.App.Obj.Poll,{appName:"poll",optHooks:["preRender","postRender"],optHTMLConfigs:{id:{name:"id",type:"string"},type:{name:"type",type:"string"}}});return new Obj}();IBTX.App.chat=function($){"use strict";var priv={};priv.cfg={room_id:null,maxNumItems:50,user:{user_id:0,name:""},readOnly:false,rest_uri:{base:IBTX.Cfg.main.apiUri.chat||IBTX.Cfg.main.apiUri.main,messages:"/chatrooms/{room_id}/messages/?user_id={user_id}&api_key={apikey}",rooms_users:"/chatrooms/{room_id}/users/?api_key={apikey}"},cssSelectors:{textarea:".rt-chat-message",submit:".rt-chat-submit",messages:".rt-chat-messages",users:".rt-online-users",users_option_ignore:".rt-default-option"},tpl:{msg:'<div class="{itemClass}">'+'<div class="time"><time>{updatedAt}</time></div>'+"<blockquote>{txt}</blockquote>"+"</div>",user_option:'<option data-id="{user_id}">{name}</option>',user_li:'<li data-id="{user_id}">{name}</li>'}};priv.data={scrollTimeout:0,disableScroll:false,num_messages:0,messages:[],users:{}};priv.hooks=function(){var priv={};priv.cfg={preRender:[],postRender:[],preSubmit:[],postUsersRender:[],postUsersEntered:[],postUsersExited:[]};priv.set=function(hookName,cb){priv.cfg[hookName].push(cb)};priv.run=function(hookName,data,cb,index){var hooks=priv.cfg[hookName];if(!index){index=0}if(hooks.length<=index){if(cb){cb(null,data)}return}hooks[index](data,function(error,data){if(error){IBTX.Mod.debug.error("chat: hook error - "+hookName);IBTX.Mod.debug.error(error);if(cb){cb(error)}}else{setTimeout(function(){index++;priv.run(hookName,data,cb,index)},0)}})};return{set:priv.set,run:priv.run}}();priv.init=function(){pub=IBTX.Core.merge(pub,IBTX.Core.create(IBTX.Core.Obj.EventEmitter,"IBTX.App.chat"));IBTX.Mod.debug.info("IBTX.App.chat init");pub.on("usersLoaded",priv.renderUsers);pub.on("dataLoaded",function(data){if(!priv.cfg.readOnly){$(priv.cfg.cssSelectors.submit).click(priv.sendMessage);$(priv.cfg.cssSelectors.textarea).keypress(priv.sendOnEnter)}IBTX.Mod.realtime.whenConnected(function(){IBTX.Mod.realtime.subscribe("chatrooms:"+priv.cfg.room_id);IBTX.Mod.realtime.subscribe("chatrooms");IBTX.Mod.realtime.subscribe("user:"+IBTX.Mod.user.uid());IBTX.Mod.realtime.on("message::chatrooms:"+priv.cfg.room_id+"::message",priv.renderMessage);IBTX.Mod.realtime.on("message::chatrooms:"+priv.cfg.room_id+"::userEntered",priv.userEntered);IBTX.Mod.realtime.on("message::chatrooms:"+priv.cfg.room_id+"::userExited",priv.userExited);IBTX.Mod.realtime.on("message::chatrooms::message",priv.renderMessage);IBTX.Mod.realtime.on("message::user:"+IBTX.Mod.user.uid()+"::chat",priv.renderMessage)});priv.renderMessages(data)});$(priv.cfg.cssSelectors.messages).parent().scroll(priv.checkDisableScroll);pub.on("renderedItem",priv.scrollDown);IBTX.on("started",priv.start);return pub};priv.setConfiguration=function(cfg){if(cfg.room_id){priv.cfg.room_id=cfg.room_id}if(cfg.user){priv.cfg.user=cfg.user}else{priv.cfg.user.user_id=IBTX.Mod.user.uid()}if(cfg.readOnly){priv.cfg.readOnly=cfg.readOnly}};priv.start=function(){if(!priv.cfg.room_id){return}IBTX.Mod.debug.info("IBTX.App.chat started");priv.registerUserData();priv.loadMessages();priv.loadUsers()};priv.registerUserData=function(){if(priv.cfg.readOnly){return false}var uri=priv.cfg.rest_uri.base+priv.cfg.rest_uri.rooms_users;uri=uri.replace("{apikey}",IBTX.Cfg.main.apiKey);uri=uri.replace("{room_id}",priv.cfg.room_id);IBTX.Mod.ortcRest.POST(uri,priv.cfg.user,function(error,data){if(error){IBTX.Mod.debug.error(error);return}})};priv.loadMessages=function(){var uri=priv.cfg.rest_uri.base+priv.cfg.rest_uri.messages;uri=uri.replace("{apikey}",IBTX.Cfg.main.apiKey);uri=uri.replace("{user_id}",priv.cfg.user.user_id);uri=uri.replace("{room_id}",priv.cfg.room_id);IBTX.Mod.ortcRest.GET(uri,function(error,data){if(error){IBTX.Mod.debug.error(error);return}pub.emit("dataLoaded",data._records)})};priv.loadUsers=function(){var uri=priv.cfg.rest_uri.base+priv.cfg.rest_uri.rooms_users;uri=uri.replace("{apikey}",IBTX.Cfg.main.apiKey);uri=uri.replace("{room_id}",priv.cfg.room_id);IBTX.Mod.ortcRest.GET(uri,function(error,data){if(error){IBTX.Mod.debug.error(error);return}pub.emit("usersLoaded",data._records)})};priv.renderMessage=function(data){priv.renderMessages([data])};priv.renderMessages=function(data){var i=0,tpl="",time,odd,itemClass,$elm,$children;priv.hooks.run("preRender",data,function(error,data){for(i=0;i<data.length;i++){odd=priv.data.num_messages%2;itemClass=odd?"odd":"even";tpl=priv.cfg.tpl.msg;time=new Date(data[i].updatedAt);tpl=tpl.replace("{updatedAt}",IBTX.Hlp.string.padLeft(time.getHours(),2,0)+":"+IBTX.Hlp.string.padLeft(time.getMinutes(),2,0));tpl=tpl.replace("{txt}",data[i].txt);tpl=tpl.replace("{itemClass}",itemClass);$elm=$(tpl);$elm.appendTo($(priv.cfg.cssSelectors.messages));$children=$(priv.cfg.cssSelectors.messages).children();if($children.length>priv.cfg.maxNumItems){$children[0].remove()}priv.hooks.run("postRender",$elm.get(0));pub.emit("renderedItem",$elm.get(0));priv.data.num_messages++}})};priv.renderUsers=function(data){var i;for(i=0;i<data.length;i++){priv.addUser(data[i])}};priv.userEntered=function(user){priv.addUser(user);priv.hooks.run("postUsersEntered",user)};priv.userExited=function(user){priv.removeUser(user);priv.hooks.run("postUsersExited",user)};priv.addUser=function(user){var tpl,userContainer,isSelect;if(!user.user_id){return}if(!user.name){return}if(user.user_id==priv.cfg.user.user_id){return}userContainer=$(priv.cfg.cssSelectors.users);isSelect=userContainer.is("select");priv.data.users[user.user_id]=user;
if(isSelect){tpl=priv.cfg.tpl.user_option}else{tpl=priv.cfg.tpl.user_li}tpl=tpl.replace("{user_id}",user.user_id);tpl=tpl.replace("{name}",user.name);userContainer.append(tpl);priv.hooks.run("postUsersRender",user)};priv.removeUser=function(user){var elm;if(!user.user_id){return}delete priv.data.users[user.user_id];elm=$(priv.cfg.cssSelectors.users).find("[data-id="+user.user_id+"]");elm.remove();priv.hooks.run("postUsersRender",user)};priv.checkDisableScroll=function(e){var $elm=$(this);clearTimeout(priv.data.scrollTimeout);priv.data.scrollTimeout=setTimeout(function(){var h=$elm.find(priv.cfg.cssSelectors.messages).outerHeight();var scrollH=$elm.scrollTop()+$elm.innerHeight()+20;if(scrollH>h){priv.data.disableScroll=false}else{priv.data.disableScroll=true}},400)};priv.scrollDown=function(){if(priv.data.disableScroll){$(priv.cfg.cssSelectors.messages).css("opacity",.8);setTimeout(function(){$(priv.cfg.cssSelectors.messages).css("opacity",1)},100);return}clearTimeout(priv.data.scrollTimeout);priv.data.scrollTimeout=setTimeout(function(){var $elm=$(priv.cfg.cssSelectors.messages).parent();$elm.scrollTop($elm.get(0).scrollHeight)},300)};priv.sendOnEnter=function(event){if(event.which==13){priv.sendMessage()}};priv.sendMessage=function(){var $textarea=$(priv.cfg.cssSelectors.textarea),txt=$textarea.val();if(!txt||txt==""){return}$textarea.val("");priv.hooks.run("preSubmit",txt,function(error,txt){var uri=priv.cfg.rest_uri.base+priv.cfg.rest_uri.messages,to=$(priv.cfg.cssSelectors.textarea).attr("data-to");uri=uri.replace("{apikey}",IBTX.Cfg.main.apiKey);if(to){uri=uri.replace("{user_id}",to)}else{uri=uri.replace("user_id={user_id}&","")}uri=uri.replace("{room_id}",priv.cfg.room_id);IBTX.Mod.ortcRest.POST(uri,{user_id:priv.cfg.user.user_id,txt:txt},function(error,data){})})};var pub={setConfiguration:priv.setConfiguration,setRoomId:priv.setRoomId,start:priv.start,setHook:priv.hooks.set};return priv.init()}(IBTX.jQuery);IBTX.App.presence=function(){"use strict";var priv={data:{pingChannel:null}},konst={},pub={};konst.DEFAULT_PING_INTERVAL=45*1e3;konst.PAGE_ID=IBTX.Mod.page.konst.PAGE_ID;konst.PING_CHANNEL_PREFIX="pageview:";konst.USER_ID=IBTX.Mod.user.konst.UID;konst.DEFAULT_NR_SERVER_CHANNELS=3;konst.TAB_ID=IBTX.Mod.tab.konst.TAB_ID;priv.events=IBTX.Core.create(IBTX.Core.Obj.EventEmitter,"IBTX.App.presence");priv.setConfiguration=function(options){priv.data.nrServerChannels=options&&options.nrServerChannels||konst.DEFAULT_NR_SERVER_CHANNELS;priv.data.pingInterval=options&&options.pingInterval||konst.DEFAULT_PING_INTERVAL;priv.setChannel();IBTX.Mod.debug.info(IBTX.Hlp.json.stringify(priv.data))};priv.setChannel=function(){var numChannels=priv.data.nrServerChannels,serverWorkerId=numChannels<2?1:Math.round(Math.random()*10)%numChannels;priv.data.pingChannel=konst.PING_CHANNEL_PREFIX+serverWorkerId};priv.sendPing=function(sendUrl){var message={pag_id:konst.PAGE_ID,uid:konst.USER_ID,tid:konst.TAB_ID};if(sendUrl){message.url=IBTX.Hlp.url.getCanonical()}IBTX.Mod.realtime.send(priv.data.pingChannel,message);IBTX.Mod.debug.info("Sending ping to "+priv.data.pingChannel);pub.emit("sentPing",message)};priv.start=function(){IBTX.Mod.realtime.whenConnected(function(){IBTX.Mod.debug.info("Starting Presence. Setting ping interval");priv.sendPing(true);priv.data.intervals=function setPingTimer(){setTimeout(function(){priv.sendPing(false);setPingTimer()},priv.data.pingInterval)}()})};priv.init=function(){priv.setConfiguration();IBTX.once(IBTX.konst.EVT_FRAMEWORK_STARTED,priv.start);return pub};pub=priv.events;pub.start=priv.start;pub.setConfiguration=priv.setConfiguration;return priv.init()}();IBTX.App.Obj.Stats=function(elem$){"use strict";var priv={},konst={},pub={};priv.cfg={renderImmediately:false};priv.view={};priv.data={intervals:{render:null},channel:"",cache:{total:0},pageId:null,showUsers:true};konst.HOOK_PRERENDER=IBTX.App.stats.konst.HOOK_PRERENDER;konst.HOOK_POSTRENDER=IBTX.App.stats.konst.HOOK_POSTRENDER;konst.WS_URL=IBTX.Cfg.main.apiUri.presence+"/stats";konst.DEFAULT_INTERVAL=0;konst.DEFAULT_MINIMUM_USERS=0;konst.GLOBAL_CHANNEL="stats";konst.PAGE_ID=IBTX.Mod.page.konst.PAGE_ID;konst.CHANNEL_PREFIX="stats:";konst.DEFAULT_CHANNEL=konst.CHANNEL_PREFIX+konst.PAGE_ID;priv.processMsg=function(stats){var items=0,prevTotal=priv.data.cache.total;if(IBTX.Core.check.isObject(stats)){items=priv.data.showUsers===false&&stats.pages!=="undefined"?parseInt(stats.pages,10):items=parseInt(stats.users,10);if(IBTX.Hlp.number.isInteger(items)){priv.data.cache.total=items;if(priv.data.pageId!==null){IBTX.App.stats.items[priv.data.pageId]=items}if(priv.cfg.renderImmediately===true&&items!==prevTotal){priv.view.render(priv.data.cache.total)}}else{IBTX.Mod.debug.warn("Users is not an integer: "+items)}}else{IBTX.Mod.debug.error("Stats is not an object: "+stats)}};priv.preload=function(){var statsKey=priv.data.channel==="stats"?"global":"pages/"+priv.data.pageId,url=konst.WS_URL+"/"+statsKey+"/?api_key="+IBTX.Cfg.main.apiKey;if(priv.data.pageId!==null){if(typeof IBTX.App.stats.items[priv.data.pageId]!=="undefined"){priv.processMsg({pageId:priv.data.pageId,users:IBTX.App.stats.items[priv.data.pageId]});return}}IBTX.Mod.ortcRest.GET(url,function(err,data){priv.processMsg(data._data)})};priv.view.start=function(){if(priv.cfg.renderImmediately===false){priv.data.intervals.render=setInterval(function(){priv.view.render(priv.data.cache.total)},priv.cfg.renderInterval)}};priv.view.stop=function(){if(priv.cfg.renderImmediately===false){clearTimeout(priv.data.intervals.render)}};priv.view.render=function(total){var cbData={total:total};priv.hooks.run(konst.HOOK_PRERENDER,cbData,function(err,data,preventDefaults){var total=data.total;if(!err&&!preventDefaults){if(total<priv.cfg.minimumItems){total=priv.cfg.minimumItems}priv.data.elem$.html(total);priv.hooks.run(konst.HOOK_POSTRENDER,priv.data.elem$.get(0))}else{IBTX.Mod.debug.error(err)}})};priv.setChannel=function(channel,pageId){var attr;if(channel&&pageId){priv.data.channel=channel;priv.data.pageId=pageId}else if(priv.data.elem$.attr("data-rt-statsid")){priv.data.pageId=priv.data.elem$.attr("data-rt-statsid");priv.data.channel=konst.CHANNEL_PREFIX+priv.data.pageId}else if(priv.data.elem$.attr("data-rt-statstype")){attr=priv.data.elem$.attr("data-rt-statstype");if(attr==="page"){priv.data.channel=konst.DEFAULT_CHANNEL;priv.data.pageId=konst.PAGE_ID}else if(attr==="global"){priv.data.channel=konst.GLOBAL_CHANNEL}else if(attr==="globalPages"){priv.data.channel=konst.GLOBAL_CHANNEL;priv.data.showUsers=false}}else{priv.data.channel=konst.DEFAULT_CHANNEL;priv.data.pageId=konst.PAGE_ID}};priv.onMessage=function statsOnMessage(data){priv.processMsg(data.message||data)};priv.start=function(){priv.setChannel();priv.setConfiguration();IBTX.Mod.realtime.whenConnected(function(){IBTX.Mod.realtime.subscribe(priv.data.channel,priv.onMessage)});IBTX.Mod.realtime.on("disconnected",priv.view.stop);IBTX.Mod.realtime.on("reconnected",priv.view.start);priv.preload();priv.view.start()};priv.bindHookManager=function(hookMan){priv.hooks=hookMan};priv.setConfiguration=function(){var cfg=priv.data.elem$.data("cfg");priv.cfg.renderInterval=cfg&&cfg["renderInterval"]||parseInt(priv.data.elem$.attr("data-rt-render-interval"),10);priv.cfg.minimumItems=cfg&&cfg["minimumItems"]||parseInt(priv.data.elem$.attr("data-rt-minimum-items"),10);priv.cfg.renderImmediately=priv.cfg.renderInterval>0?false:true;priv.cfg.renderInterval=priv.cfg.renderInterval||konst.DEFAULT_INTERVAL;priv.cfg.minimumItems=priv.cfg.minimumItems||konst.DEFAULT_MINIMUM_USERS};pub.bindHookManager=priv.bindHookManager;pub.hooks=priv.hooks;pub.start=priv.start;priv.data.elem$=elem$;return pub};IBTX.App.stats=function($){"use strict";var priv={cfg:{}},konst={},pub={};konst={CONTROLLER_DATA_ATTR_SEL_ID:"data-rt-sel-id",CONTROLLER_SELECTOR:".rt-stats",HOOK_PRERENDER:"preRender",HOOK_POSTRENDER:"postRender"};priv.refs={len:0};priv.init=function(){priv.setConfiguration();IBTX.once("started",function(){priv.start()});return pub};priv.start=function(){var obj={};IBTX.Mod.debug.info("Starting stats");if($(priv.cfg.viewSelector).length<=0){IBTX.Mod.debug.info('Not initiating STATS application. Missing html element for stats, eg <div class="rt-stats" id="myrtId"></div>.');return}priv.find().each(function(ref){var jqElm=$(ref.htmlNode);if(jqElm.length&&!priv.refs[jqElm.attr(konst.CONTROLLER_DATA_ATTR_SEL_ID)].started){obj=new IBTX.App.Obj.Stats(jqElm);obj.bindHookManager(ref.hooks);obj.start();priv.refs[jqElm.attr(konst.CONTROLLER_DATA_ATTR_SEL_ID)].started=true}})};priv.getHookManager=function(elem$){var hooks=[konst.HOOK_PRERENDER,konst.HOOK_POSTRENDER],hooksFn=elem$.data("rt-hooksman");if(!hooksFn){hooksFn=new IBTX.Core.Obj.HookManager(hooks);elem$.data("rt-hooksman",hooksFn)}return hooksFn};priv.setConfiguration=function(options){priv.cfg.viewSelector=options&&options.selector||konst.CONTROLLER_SELECTOR;priv.cfg.viewDataAttr=options&&options.dataAttr||konst.CONTROLLER_DATA_ATTR_SEL_ID;pub.konst.SELECTOR=priv.cfg.viewSelector};priv.find=function(sel){var ret=[];sel=sel||priv.cfg.viewSelector;$(sel).each(function(){var outerObj,elem$=$(this);if(!elem$.attr(priv.cfg.viewDataAttr)){priv.refs.len+=1;elem$.attr(priv.cfg.viewDataAttr,priv.refs.len);priv.refs[priv.refs.len]={jqElm:elem$,setConfiguration:function(opts){elem$.data("cfg",opts)},hooks:priv.getHookManager(elem$)}}outerObj=priv.refs[elem$.attr(priv.cfg.viewDataAttr)];ret.push({htmlNode:outerObj.jqElm[0],setConfiguration:outerObj.setConfiguration,hooks:outerObj.hooks})});return new IBTX.Hlp.Obj.Iterator(ret)};priv.each=function(cb){return priv.find().each(cb)};pub.start=priv.start;pub.setConfiguration=priv.setConfiguration;pub.konst={HOOK_PRERENDER:konst.HOOK_PRERENDER,HOOK_POSTRENDER:konst.HOOK_POSTRENDER,SELECTOR:konst.CONTROLLER_SELECTOR};pub.items={};pub.find=priv.find;pub.each=priv.each;return priv.init()}(IBTX.jQuery);IBTX.App.Obj.Top=function($){"use strict";var konst={},statik={},Obj=function(){};konst.API_BASE_URL=IBTX.Cfg.main.apiUri.presence+"/tops/";konst.DEFAULT_FILTER="type:article";konst.DEFAULT_NUM_ITEMS=10;konst.DEFAULT_ITEM_TPL='<li class="rt-top-item" data-rt-top-item-score="{{total}}" data-rt-top-item-id="{{pageId}}"><a class="{{meta.url}}">{{{meta.title}}}</a><br/><span class="rt-top-item-total">{{total}}</span> online users</li>';konst.CHANNEL_STATS_PREFIX="stats:";konst.CHANNEL_PREFIX="tops:";statik.getList=function(q,numItems,extraFields,callback){var url=konst.API_BASE_URL+"?api_key="+IBTX.Cfg.main.apiKey+"&q="+q+"&limit="+numItems;if(extraFields){url+="&fields="+extraFields}IBTX.Mod.ortcRest.GET(url,function(err,data){callback(err,data)})};Obj=function(elem$){var that=this;that.data={items:{},diffsCounter:0};that.cfg={};that.data.elem=elem$};Obj.prototype.setKonstants=function(){konst.DATA_ATTR_ITEM_ID=IBTX.App.top.konst.DATA_ATTR_ITEM_ID;konst.DATA_ATTR_NUM_ITEMS=IBTX.App.top.konst.DATA_ATTR_NUM_ITEMS;konst.ITEM_SELECTOR=IBTX.App.top.konst.ITEM_SELECTOR;konst.DATA_ATTR_ITEM_ID=IBTX.App.top.konst.DATA_ATTR_ITEM_ID;konst.DATA_ATTR_ITEM_SCORE=IBTX.App.top.konst.DATA_ATTR_ITEM_SCORE;konst.DATA_ATTR_ITEM_RANK=IBTX.App.top.konst.DATA_ATTR_ITEM_RANK;konst.HOOK_PRERENDER=IBTX.App.top.konst.HOOK_PRERENDER;konst.HOOK_RENDER=IBTX.App.top.konst.HOOK_RENDER;konst.HOOK_POSTRENDER=IBTX.App.top.konst.HOOK_POSTRENDER;konst.HOOK_PREDELETE=IBTX.App.top.konst.HOOK_PREDELETE;konst.HOOK_RENDERDELETE=IBTX.App.top.konst.HOOK_RENDERDELETE;konst.HOOK_POSTDELETE=IBTX.App.top.konst.HOOK_POSTDELETE;konst.SELECTOR_ITEM_SCORE=konst.DATA_ATTR_ITEM_SCORE.replace("data-",".");konst.SELECTOR_ITEM_RANK=konst.DATA_ATTR_ITEM_RANK.replace("data-",".");konst.DATA_ATTR_ITEM_DIFFS_COUNTER="data-rt-top-diffs-counter";konst.DATA_ATTR_EXTRA_FIELDS="data-rt-top-extra-fields"};Obj.prototype.setConfiguration=function(){var that=this,defaultTpl=konst.DEFAULT_ITEM_TPL,cfg=that.data.elem.data("cfg");that.cfg.numItems=cfg&&cfg["numItems"]||that.data.elem.attr(IBTX.App.top.konst.DATA_ATTR_NUM_ITEMS);that.cfg.filter=cfg&&cfg["filter"]||that.data.elem.attr(IBTX.App.top.konst.DATA_ATTR_FILTER);that.cfg.status=cfg&&cfg["status"]||that.data.elem.attr(IBTX.App.top.konst.DATA_ATTR_STATUS);that.cfg.extraFields=cfg&&cfg["extraFields"]||that.data.elem.attr(konst.DATA_ATTR_EXTRA_FIELDS);if(that.data.elem.prop("tagName")==="DIV"){defaultTpl=defaultTpl.replace("<li","<div");defaultTpl=defaultTpl.replace("</li>","</div>")}that.cfg.item_tpl=cfg&&cfg.itemTpl||defaultTpl;that.cfg.numItems=that.cfg.numItems||konst.DEFAULT_NUM_ITEMS;that.cfg.status=that.cfg.status||IBTX.App.top.konst.STATE_ACTIVE;that.cfg.filter=that.cfg.filter||konst.DEFAULT_FILTER;that.cfg.item_tpl=that.cfg.item_tpl.replace(/^\s+|\s+$/g,"");that.cfg.filter=encodeURI(that.cfg.filter.replace(/^\s+|\s+$/g,""))};Obj.prototype.getList=function(){var that=this;that.data.isFetchingData=true;statik.getList(that.getFilter(),that.getNumItems(),that.cfg.extraFields,function(err,data){that.data.isFetchingData=false;if(!err){that.processRestData(data)}else{IBTX.Mod.debug.warn(err)}})};Obj.prototype.getNumItems=function(){var that=this;return that.cfg.numItems};Obj.prototype.getFilter=function(){var that=this;return that.cfg.filter};Obj.prototype.processRestData=function(restData){var that=this,data=restData&&restData._records?restData._records:[],topId=restData&&restData._metadata?restData._metadata.id:null,totalItems=data.length||0;if(totalItems===0){return}if(that.data.renderedOnce===false){that.subscribeRtDiffs(topId);if(that.data.elem.find("["+konst.DATA_ATTR_ITEM_ID+"]").length===0){that.data.elem.html("")}that.data.renderedOnce=true}that.processItems(false,data)};Obj.prototype.processDiffs=function(diffs){var that=this,i=0,entered=diffs.enter,left=diffs.leave,currentCounter=parseInt(diffs.counter||0,10),lastCounter=that.data.diffsCounter;if(lastCounter!==0){if(currentCounter-lastCounter!==1){IBTX.Mod.debug.warn("skipped a msg");that.data.diffsCounter=parseInt(diffs.counter,10);that.getList();return}}that.data.diffsCounter=parseInt(diffs.counter,10);for(i=0;i<left.length;i+=1){that.delItem(left[i])}that.processItems(false,entered)};Obj.prototype.processPageStats=function(pageId,data){var that=this,i=0,items=that.data.items;if(items[pageId]){items[pageId].total=parseInt(data.total,10);that.processItems(true)}};Obj.prototype.processItems=function(isScoreAltered,items){var that=this,i=0,pageId="",currentItems=that.data.items,totalItems=0;isScoreAltered=isScoreAltered||false;items=items||currentItems;totalItems=items.length;if(isScoreAltered===false){for(i=0;i<totalItems;i+=1){if(items[i].pageId){if(!that.data.items[items[i].pageId]){that.subscribeRtItem(items[i].pageId)}that.data.items[items[i].pageId]=items[i]}}}that.setRankings();for(pageId in currentItems){if(currentItems.hasOwnProperty(pageId)){that.upsertItem(currentItems[pageId])}}that.cleanUp()};Obj.prototype.delItem=function(info){var that=this;delete that.data.items[info.pageId];delete that.data.rankings.pageIds[info.pageId];that.setRankings();info.rank=-1;that.unsubscribeRtItem(info.pageId);that.renderDelItem(info)};Obj.prototype.upsertItem=function(info){var that=this;that.data.items[info.pageId]=info;info.rank=that.getRank(info.pageId);that.renderUpsertItem(info)};Obj.prototype.getRank=function(pageId){var that=this;return that.data.rankings.pageIds[pageId]};Obj.prototype.setRankings=function(){var that=this,items=that.data.items,pageId="",i=0,rankings=[];for(pageId in items){if(items.hasOwnProperty(pageId)){rankings.push({pageId:pageId,total:parseInt(items[pageId].total,10)})}}rankings.sort(function(a,b){return b.total-a.total});for(i=0;i<rankings.length;i+=1){that.data.rankings.pageIds[rankings[i].pageId]=i}that.data.rankings.current=rankings};Obj.prototype.subscribeRtItem=function(itemId){var that=this,channel=konst.CHANNEL_STATS_PREFIX+itemId;function topsOnRtItemMessage(data){data=data.message||data;data.total=data.users;that.processPageStats(itemId,data)}that.onRtItemMessage=topsOnRtItemMessage;IBTX.Mod.realtime.subscribe(channel,that.onRtItemMessage)};Obj.prototype.subscribeRtDiffs=function(topId){var that=this,channel=konst.CHANNEL_PREFIX+topId+"__"+that.cfg.numItems;if(IBTX.Mod.realtime.isSubscribed(channel)===false){IBTX.Mod.debug.info("Subscribing "+channel);IBTX.Mod.realtime.subscribe(channel,function(data){data=data.message||data;that.processDiffs(data)})}};Obj.prototype.unsubscribeRtItem=function(itemId){var that=this,channel=konst.CHANNEL_STATS_PREFIX+itemId;if(IBTX.Mod.realtime.isSubscribed(channel)===true){IBTX.Mod.realtime.unsubscribe(channel,that.onRtItemMessage)}};Obj.prototype.renderDelItem=function(pageInfo){var that=this,elem$={},elem={};elem=that.getNodeOfItem(pageInfo);if(elem){that.hooks.run(konst.HOOK_PREDELETE,pageInfo,function(err,data,preventsDefault){if(!err&&!preventsDefault){that.hooks.run(konst.HOOK_RENDERDELETE,elem,data,function(err,currentNode,data,preventsDefault){if(!err&&!preventsDefault){elem$=that.data.elem.find(currentNode);elem$.remove()}that.hooks.run(konst.HOOK_POSTRENDER,currentNode,data)})}})}};Obj.prototype.getNodeOfItem=function(info){var that=this,items=[],selector="";selector=that.getNodeSelector(info);items=that.data.elem.find(selector);return items&&items.length>0?items[0]:null};Obj.prototype.getNodeSelector=function(info){return konst.ITEM_SELECTOR+"["+konst.DATA_ATTR_ITEM_ID+'="'+info.pageId+'"]'};Obj.prototype.renderUpsertItem=function(pageInfo){var that=this,currentNode={};that.hooks.run(konst.HOOK_PRERENDER,pageInfo,function(err,data,preventsDefault){if(!err&&data&&!preventsDefault){currentNode=that.getNodeOfItem(data);if(!currentNode){that.renderNewNode(data)}else{that.renderUpdateNode(data,currentNode)}}else if(err){IBTX.Mod.debug.error(err)}})};Obj.prototype.renderNewNode=function(data){data.action="new";var that=this,tpl=that.data.item_tpl_compiled,newNode=$(tpl(data));that.hooks.run(konst.HOOK_RENDER,newNode,data,function(err,currentNode,data,preventsDefault){if(!err&&!preventsDefault){that.data.elem.append(currentNode);currentNode=that.data.elem.find(that.getNodeSelector(data));$(currentNode).attr(konst.DATA_ATTR_ITEM_DIFFS_COUNTER,that.data.diffsCounter)}that.hooks.run(konst.HOOK_POSTRENDER,currentNode,data)})};Obj.prototype.renderUpdateNode=function(data,currentNode){var that=this,elem$={},newNode={};data.action="update";elem$=that.data.elem.find(currentNode);newNode=elem$.clone(true);$(newNode).attr(konst.DATA_ATTR_ITEM_SCORE,data.total);$(newNode).find(konst.SELECTOR_ITEM_SCORE).text(data.total);$(newNode).find(konst.SELECTOR_ITEM_RANK).text(data.rank);$(newNode).attr(konst.DATA_ATTR_ITEM_DIFFS_COUNTER,that.data.diffsCounter);that.hooks.run(konst.HOOK_RENDER,newNode,data,function(err,currentNode,data,preventsDefault){if(!err&&!preventsDefault){elem$.replaceWith(currentNode)}that.hooks.run(konst.HOOK_POSTRENDER,currentNode,data)})};Obj.prototype.cleanUp=function(){var that=this,items=[],item={},i=0,pageId="",tooDelayed=false,previousCounter=that.data.diffsCounter-1,diffsCounter=0,selector=konst.ITEM_SELECTOR+"["+konst.DATA_ATTR_ITEM_DIFFS_COUNTER+'!="'+previousCounter+'"]';if(that.data.isFetchingData||that.data.diffsCounter===0){return}items=that.data.elem.find(selector);if(items){for(i=0;i<items.length;i+=1){item=items[i];pageId=item.getAttribute(konst.DATA_ATTR_ITEM_ID);diffsCounter=parseInt(item.getAttribute(konst.DATA_ATTR_ITEM_DIFFS_COUNTER),10);if(pageId&&diffsCounter){tooDelayed=Math.abs(parseInt(previousCounter,10)-diffsCounter)>=2?true:false;if(tooDelayed){IBTX.Mod.debug.info("Cleaning up will delete an incorrect pageId "+pageId+"; diffsCounter: "+diffsCounter+", previousCounter "+previousCounter);that.delItem({pageId:pageId})}}}}};Obj.prototype.start=function(){var that=this;that.setKonstants();that.setConfiguration();that.data.item_tpl_compiled=IBTX.thirdParty.Handlebars.compile(that.cfg.item_tpl);that.data.renderedOnce=false;that.data.isFetchingData=false;that.data.rankings={pageIds:{},current:[]};IBTX.Mod.realtime.whenConnected(function(){that.getList()})};Obj.prototype.bindHookManager=function(hookMan){var that=this;that.hooks=hookMan};return Obj}(IBTX.jQuery);IBTX.App.top=function($){"use strict";var konst={},statik={},pub={};konst={CONTAINER_SELECTOR:".rt-top",ITEM_SELECTOR:".rt-top-item",DATA_ATTR_SEL_ID:"data-rt-top-id",DATA_ATTR_FILTER:"data-rt-top-filter",DATA_ATTR_NUM_ITEMS:"data-rt-top-num-items",DATA_ATTR_STATUS:"data-rt-top-status",DATA_ATTR_ITEM_SCORE:"data-rt-top-item-total",DATA_ATTR_ITEM_RANK:"data-rt-top-item-rank",DATA_ATTR_ITEM_ID:"data-rt-top-item-id",DATA_ATTR_ITEM_TPL:"data-rt-top-item-tpl",STATE_ACTIVE:"active",HOOK_RENDER:"render",HOOK_POSTRENDER:"postRender",HOOK_PRERENDER:"preRender",HOOK_PREDELETE:"preDelete",HOOK_RENDERDELETE:"renderDelete",HOOK_POSTDELETE:"postDelete"};statik.refs={len:0};statik.hooks={};statik.getHookManager=function(elem$){var hooks=[konst.HOOK_RENDER,konst.HOOK_PRERENDER,konst.HOOK_POSTRENDER,konst.HOOK_PREDELETE,konst.HOOK_RENDERDELETE,konst.HOOK_POSTDELETE],hooksFn=elem$.data("rt-hooksman");if(!hooksFn){hooksFn=new IBTX.Core.Obj.HookManager(hooks);elem$.data("rt-hooksman",hooksFn)}return hooksFn};statik.find=function(sel){var ret=[],elem$={};sel=sel||konst.CONTAINER_SELECTOR;$(sel).each(function(){elem$=$(this);statik.refs.len+=1;elem$.attr(konst.DATA_ATTR_SEL_ID,statik.refs.len);statik.refs[statik.refs.len]={jqElm:elem$,setConfiguration:function(opts){elem$.data("cfg",opts)},hooks:statik.getHookManager(elem$)};ret.push(statik.refs[elem$.attr(konst.DATA_ATTR_SEL_ID)])});return new IBTX.Hlp.Obj.Iterator(ret)};statik.each=function(cb){return statik.find().each(cb)};statik.start=function(){var obj={};statik.find().each(function(ref){if(ref.jqElm){if(!ref.jqElm.attr(konst.DATA_ATTR_STATUS)||ref.jqElm.attr(konst.DATA_ATTR_STATUS)!==konst.STATE_ACTIVE){obj=new IBTX.App.Obj.Top(ref.jqElm);obj.bindHookManager(ref.hooks);obj.start();ref.jqElm.attr(konst.DATA_ATTR_STATUS,konst.STATE_ACTIVE)}}})};pub={find:statik.find,each:statik.each,start:statik.start,konst:{DATA_ATTR_FILTER:konst.DATA_ATTR_FILTER,DATA_ATTR_STATUS:konst.DATA_ATTR_STATUS,DATA_ATTR_NUM_ITEMS:konst.DATA_ATTR_NUM_ITEMS,ITEM_SELECTOR:konst.ITEM_SELECTOR,DATA_ATTR_ITEM_ID:konst.DATA_ATTR_ITEM_ID,DATA_ATTR_ITEM_SCORE:konst.DATA_ATTR_ITEM_SCORE,DATA_ATTR_ITEM_RANK:konst.DATA_ATTR_ITEM_RANK,HOOK_PRERENDER:konst.HOOK_PRERENDER,HOOK_RENDER:konst.HOOK_RENDER,HOOK_POSTRENDER:konst.HOOK_POSTRENDER,HOOK_PREDELETE:konst.HOOK_PREDELETE,HOOK_RENDERDELETE:konst.HOOK_RENDERDELETE,HOOK_POSTDELETE:konst.HOOK_POSTDELETE}};IBTX.once(IBTX.konst.EVT_FRAMEWORK_STARTED,statik.start);return pub}(IBTX.jQuery);IBTX.App.socialStream=function($){"use strict";var konst={},statik={},pub={};konst={CONTAINER_SELECTOR:".rt-socialstream",TOP_CONTAINER_SELECTOR:".rt-socialstream-top-container",ITEM_SELECTOR:".rt-socialstream-item",LOAD_OLDER_SELECTOR:".rt-socialstream-load-older",DATA_ATTR_SEL_ID:"data-rt-socialstream-id",DATA_ATTR_URL:"data-rt-socialstream-url",DATA_ATTR_FILTER:"data-rt-socialstream-filter",DATA_ATTR_MAX_CHARS:"data-rt-socialstream-max-chars",DATA_ATTR_INTERVAL:"data-rt-socialstream-interval",DATA_ATTR_NUM_ITEMS:"data-rt-socialstream-num-items",DATA_ATTR_STATUS:"data-rt-socialstream-status",DATA_ATTR_ITEM_ID:"data-rt-socialstream-item-id",DATA_ATTR_ITEM_TPL:"data-rt-socialstream-item-tpl",STATE_ACTIVE:"active",HOOK_DATA_RECEIVED:"dataReceived",HOOK_RENDER:"render",HOOK_POSTRENDER:"postRender",HOOK_PRERENDER:"preRender",HOOK_PREDELETE:"preDelete",HOOK_RENDERDELETE:"renderDelete"};statik.refs={len:0};statik.hooks={};statik.getHookManager=function(elem$){var hooks=[konst.HOOK_DATA_RECEIVED,konst.HOOK_RENDER,konst.HOOK_PRERENDER,konst.HOOK_POSTRENDER,konst.HOOK_PREDELETE,konst.HOOK_RENDERDELETE,konst.HOOK_POSTDELETE],hooksFn=elem$.data("rt-hooksman");if(!hooksFn){hooksFn=new IBTX.Core.Obj.HookManager(hooks);elem$.data("rt-hooksman",hooksFn)}return hooksFn};statik.find=function(sel){var ret=[],elem$={};sel=sel||konst.CONTAINER_SELECTOR;$(sel).each(function(){elem$=$(this);statik.refs.len+=1;elem$.attr(konst.DATA_ATTR_SEL_ID,statik.refs.len);statik.refs[statik.refs.len]={jqElm:elem$,setConfiguration:function(elem$){return function(opts){elem$.data("cfg",opts)}}(elem$),hooks:statik.getHookManager(elem$)};ret.push(statik.refs[elem$.attr(konst.DATA_ATTR_SEL_ID)])});return new IBTX.Hlp.Obj.Iterator(ret)};statik.each=function(cb){return statik.find().each(cb)};statik.start=function(){var obj={},refId="";statik.find().each(function(ref){if(ref.jqElm){obj=new IBTX.App.Obj.SocialStream(ref.jqElm);obj.bindHookManager(ref.hooks);refId=ref.jqElm.attr(konst.DATA_ATTR_SEL_ID);if(statik.refs[refId]){statik.refs[refId].obj=obj}if(!ref.jqElm.attr(konst.DATA_ATTR_STATUS)||ref.jqElm.attr(konst.DATA_ATTR_STATUS)!==konst.STATE_ACTIVE){ref.jqElm.attr(konst.DATA_ATTR_STATUS,konst.STATE_ACTIVE);obj.start()}}})};statik.finish=function(callback,sel){var refId="",elem$={};sel=sel||konst.CONTAINER_SELECTOR;$(sel).each(function(){elem$=$(this);refId=elem$.attr(konst.DATA_ATTR_SEL_ID);if(refId&&statik.refs[refId]){statik.refs[refId].obj.finish(function(){statik.refs[refId]=null;delete statik.refs[refId]})}});if(callback){callback()}};pub={find:statik.find,each:statik.each,start:statik.start,finish:statik.finish,konst:{DATA_ATTR_URL:konst.DATA_ATTR_URL,DATA_ATTR_FILTER:konst.DATA_ATTR_FILTER,DATA_ATTR_STATUS:konst.DATA_ATTR_STATUS,DATA_ATTR_NUM_ITEMS:konst.DATA_ATTR_NUM_ITEMS,DATA_ATTR_MAX_CHARS:konst.DATA_ATTR_MAX_CHARS,DATA_ATTR_INTERVAL:konst.DATA_ATTR_INTERVAL,DATA_ATTR_ITEM_ID:konst.DATA_ATTR_ITEM_ID,CONTAINER_SELECTOR:konst.CONTAINER_SELECTOR,ITEM_SELECTOR:konst.ITEM_SELECTOR,TOP_CONTAINER_SELECTOR:konst.TOP_CONTAINER_SELECTOR,LOAD_OLDER_SELECTOR:konst.LOAD_OLDER_SELECTOR,HOOK_DATA_RECEIVED:konst.HOOK_DATA_RECEIVED,HOOK_PRERENDER:konst.HOOK_PRERENDER,HOOK_RENDER:konst.HOOK_RENDER,HOOK_POSTRENDER:konst.HOOK_POSTRENDER,HOOK_PREDELETE:konst.HOOK_PREDELETE,HOOK_RENDERDELETE:konst.HOOK_RENDERDELETE}};IBTX.once(IBTX.konst.EVT_FRAMEWORK_STARTED,statik.start);return pub}(IBTX.jQuery);IBTX.App.Obj.SocialStream=function($){"use strict";var konst={},statik={},Obj;konst.API_BASE_URL=IBTX.Cfg.main.apiUri.socialStream+"/socialstream/";konst.DEFAULT_URL=IBTX.Hlp.url.get();konst.DEFAULT_NUM_ITEMS=10;konst.DEFAULT_MAX_CHARS=200;konst.DEFAULT_INTERVAL=1e3*10;konst.DEFAULT_ITEM_TPL='<li class="rt-socialstream-item rt-socialstream-item-{{socialnetwork}}" data-rt-socialstream-item-id="{{sid}}" data-rt-socialstream-provider="{{socialnetwork}}" style="display:none;">{{#if picture}}<img src="{{picture}}" class="{{cssPicture}}" />{{/if}}{{{message}}}{{#if messagePart2}} <span style="display:none;" id="hidden_{{sid}}">{{{messagePart2}}}</span> <a href="javascript:void();" class="rt-toggler" data-rt-toggler-target="hidden_{{sid}}">...</a> {{/if}}<br/><div class="rt-socialstream-author">{{from.name}}</div><div class="rt-socialstream-icons-{{socialnetwork}}"><img src="{{socialnetworkPicture}}" /></div></li>';konst.CHANNEL_PREFIX="socialstream:";statik.getList=function(q,filterUrl,numItems,callback,sinceId){var url=konst.API_BASE_URL+"?api_key="+IBTX.Cfg.apiKey;try{q=encodeURIComponent(q);url+="&q="+q}catch(e){url+="&q="+q;IBTX.Mod.debug.error("SocialStream: error encoding "+q)}if(filterUrl){url+="&url="+filterUrl}if(sinceId){url+="&sinceId="+sinceId}url+="&limit="+numItems;IBTX.Mod.ortcRest.GET(url,function(err,data){callback(err,data)})};Obj=function(elem$){var that=this;that.data={items:{},bufferList:[],bufferDelList:[]};that.cfg={};that.data.elem=elem$;$(document).on("click",elem$.find(".rt-toggler"),function(){$("#"+$(this).attr("data-rt-toggler-target")).toggle()})};Obj.prototype.setKonstants=function(){konst.DATA_ATTR_ITEM_ID=IBTX.App.socialStream.konst.DATA_ATTR_ITEM_ID;konst.DATA_ATTR_NUM_ITEMS=IBTX.App.socialStream.konst.DATA_ATTR_NUM_ITEMS;konst.ITEM_SELECTOR=IBTX.App.socialStream.konst.ITEM_SELECTOR;konst.LOAD_OLDER_SELECTOR=IBTX.App.socialStream.konst.LOAD_OLDER_SELECTOR;konst.TOP_CONTAINER_SELECTOR=IBTX.App.socialStream.konst.TOP_CONTAINER_SELECTOR;konst.HOOK_PRERENDER=IBTX.App.socialStream.konst.HOOK_PRERENDER;konst.HOOK_RENDER=IBTX.App.socialStream.konst.HOOK_RENDER;konst.HOOK_POSTRENDER=IBTX.App.socialStream.konst.HOOK_POSTRENDER;konst.HOOK_PREDELETE=IBTX.App.socialStream.konst.HOOK_PREDELETE;konst.HOOK_RENDERDELETE=IBTX.App.socialStream.konst.HOOK_RENDERDELETE;konst.HOOK_POSTDELETE=IBTX.App.socialStream.konst.HOOK_POSTDELETE;konst.HOOK_DATA_RECEIVED=IBTX.App.socialStream.konst.HOOK_DATA_RECEIVED};Obj.prototype.setConfiguration=function(){var that=this,defaultTpl=konst.DEFAULT_ITEM_TPL,cfg=that.data.elem.data("cfg");that.cfg.numItems=cfg&&cfg.numItems||that.data.elem.attr(IBTX.App.socialStream.konst.DATA_ATTR_NUM_ITEMS);that.cfg.url=cfg&&cfg.url||that.data.elem.attr(IBTX.App.socialStream.konst.DATA_ATTR_URL);that.cfg.filter=cfg&&cfg.filter||that.data.elem.attr(IBTX.App.socialStream.konst.DATA_ATTR_FILTER);that.cfg.status=cfg&&cfg.status||that.data.elem.attr(IBTX.App.socialStream.konst.DATA_ATTR_STATUS);that.cfg.maxChars=cfg&&cfg.maxChars||that.data.elem.attr(IBTX.App.socialStream.konst.DATA_ATTR_MAX_CHARS);that.cfg.interval=cfg&&cfg.interval||that.data.elem.attr(IBTX.App.socialStream.konst.DATA_ATTR_INTERVAL);if(that.data.elem.prop("tagName")==="DIV"){defaultTpl=defaultTpl.replace("<li","<div");defaultTpl=defaultTpl.replace("</li>","</div>")}that.cfg.itemTpl=cfg&&cfg.itemTpl||defaultTpl;that.cfg.numItems=parseInt(that.cfg.numItems||konst.DEFAULT_NUM_ITEMS,10);that.cfg.maxChars=parseInt(that.cfg.maxChars||konst.DEFAULT_MAX_CHARS,10);that.cfg.status=that.cfg.status||IBTX.App.socialStream.konst.STATE_ACTIVE;that.cfg.url=that.cfg.url||konst.DEFAULT_URL;that.cfg.interval=parseInt(that.cfg.interval||konst.DEFAULT_INTERVAL,10);that.cfg.itemTpl=that.cfg.itemTpl.replace(/^\s+|\s+$/g,"");that.cfg.filter=encodeURI(that.cfg.filter.replace(/^\s+|\s+$/g,""))};Obj.prototype.getList=function(){var that=this;that.data.isFetchingData=true;statik.getList(that.getFilter(),that.getUrl(),that.getNumItems(),function(err,data){that.data.isFetchingData=false;if(!err){that.processRestData(data)}else{IBTX.Mod.debug.warn(err)}})};Obj.prototype.getNumItems=function(){var that=this;return that.cfg.numItems};Obj.prototype.getFilter=function(){var that=this;return that.cfg.filter};Obj.prototype.getUrl=function(){var that=this;return that.cfg.url};Obj.prototype.processRestData=function(restData){var that=this,data=restData&&restData._records?restData._records:[],socialStreamId=restData&&restData._metadata?restData._metadata.id:null,loadType="load",shouldSubscribe=false,totalItems=data.length||0;that.socialStreamId=socialStreamId;if(that.data.renderedOnce===false){loadType="preload";shouldSubscribe=true;if(that.data.elem.find("["+konst.DATA_ATTR_ITEM_ID+"]").length===0){that.data.elem.html("")}that.data.renderedOnce=true}that.processItems(data,loadType,restData._metadata);if(shouldSubscribe===true){setTimeout(function(){that.subscribeRtUpdates(socialStreamId)},300)}};Obj.prototype.processItems=function(items,loadType,metadata){var that=this,currentList=that.data.bufferList,k="",newData={_records:[],_meta:{}},i=0;if(!metadata){metadata={}}metadata.requestType=loadType;newData._meta=metadata;if(items){if(loadType==="preload"||loadType==="update"){items.sort(function(a,b){return a.timestamp-b.timestamp})}for(i=0;i<items.length;i=i+1){if(typeof items[i].sid==="undefined"){items[i].sid=items[i].id+"__"+items[i].socialnetwork}if(typeof items[i].from.picture==="object"&&typeof items[i].from.picture.data!=="undefined"){items[i].from.picture=items[i].from.picture.data.url||""}k=items[i].sid;if(typeof that.data.items[k]==="undefined"){items[i]._loadType=loadType;newData._records.push(items[i])}}}if(newData._records.length===0&&loadType==="update"){return}that.hooks.run(konst.HOOK_DATA_RECEIVED,newData,function(err,data,preventsDefault){if(!err&&!preventsDefault&&data._records){if(data._meta.requestType==="load"){for(i=0;i<data._records.length;i=i+1){that.upsertItem(data._records[i])}}else{currentList.unshift.apply(currentList,data._records)
}}})};Obj.prototype.doRender=function(){var that=this,elem={},sId="",itemToUpsert=that.data.bufferList.shift();if(itemToUpsert){that.upsertItem(itemToUpsert)}if(that.data.shouldRemoveHtmlItemsAboveLimit&&that.data.elem.find(konst.ITEM_SELECTOR).length>that.cfg.numItems){elem=that.data.elem.find(konst.ITEM_SELECTOR).last(),sId=that.getLast(elem);if(that.data.items[sId]){that.delItem(that.data.items[sId],elem)}}that.setTimeout()};Obj.prototype.getLast=function(elem){var that=this,sid=null;elem=elem||that.data.elem.find(konst.ITEM_SELECTOR).last();if(elem){sid=elem.attr(konst.DATA_ATTR_ITEM_ID)}return sid};Obj.prototype.setTimeout=function(){var that=this,prop="",keys=[];for(prop in that.data.items){if(hasOwnProperty.call(that.data.items,prop)){keys.push(prop)}}if(keys.length<that.cfg.numItems){that.timer=setTimeout(function(){that.doRender()},80)}else{that.timer=setTimeout(function(){that.doRender()},that.cfg.interval)}};Obj.prototype.delItem=function(info,elem){var that=this;delete that.data.items[info.sid];that.renderDelItem(info,elem)};Obj.prototype.upsertItem=function(info){var that=this,re=/(\b(https?):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,subs="<a href='$1' target='_blank'>$1</a>",messageParts=[],k=info.sid;if(typeof that.data.items[k]==="undefined"){info.socialnetworkPicture=IBTX.Cfg.main.baseUri+"/images/icon_"+info.socialnetwork+".gif";info.cssPicture="rt-socialstream-img";if(info.picture){info.cssPicture="rt-socialstream-img"}info.message=info.message.replace(/<([^>]+)>/g,"");if(info.message.length>that.cfg.maxChars){messageParts=IBTX.Hlp.string.splitByLength(info.message,that.cfg.maxChars);info.message=messageParts[0];info.messagePart2=messageParts[1];if(info.messagePart2.indexOf("http")!==-1){info.messagePart2=info.messagePart2.replace(re,subs)}}if(info.message.indexOf("http")!==-1){info.message=info.message.replace(re,subs)}that.data.items[k]=info;that.renderItem(info)}else{IBTX.Mod.debug.info("Skipping rendering item. Already there")}};Obj.prototype.renderItem=function(info){var that=this,currentNode={};that.hooks.run(konst.HOOK_PRERENDER,info,function(err,data,preventsDefault){if(!err&&data&&!preventsDefault){currentNode=that.getNodeOfItem(data);if(!currentNode){that.renderNewNode(data)}}})};Obj.prototype.renderNewNode=function(data){var that=this,elem$={},tpl=that.data.itemTplCompiled,newNode=$(tpl(data));that.hooks.run(konst.HOOK_RENDER,newNode,data,function(err,currentNode,data,preventsDefault){if(!err&&!preventsDefault){if(data._loadType==="load"){that.data.elem.append(currentNode)}else{that.data.elem.prepend(currentNode)}currentNode=that.data.elem.find(that.getNodeSelector(data));elem$=that.data.elem.find(currentNode);elem$.slideDown("slow")}that.hooks.run(konst.HOOK_POSTRENDER,currentNode,data)})};Obj.prototype.renderDelItem=function(info,elem){var that=this,elem$={};if(elem){that.hooks.run(konst.HOOK_PREDELETE,info,function(err,data,preventsDefault){if(!err&&!preventsDefault){that.hooks.run(konst.HOOK_RENDERDELETE,elem,data,function(err,currentNode,data,preventsDefault){if(!err&&!preventsDefault){elem$=that.data.elem.find(currentNode);elem$.slideUp("slow",function(){elem$.remove()})}that.hooks.run(konst.HOOK_POSTRENDER,currentNode,data)})}})}};Obj.prototype.subscribeRtUpdates=function(socialstreamId){var that=this,channel=konst.CHANNEL_PREFIX+socialstreamId;IBTX.Mod.debug.info("Subscribing "+channel);IBTX.Mod.realtime.subscribe(channel,true,function(data){IBTX.Mod.debug.info("New data from ortc");data=data.message||data;that.processItems(data,"update")})};Obj.prototype.getNodeOfItem=function(info){var that=this,items=[],selector="";selector=that.getNodeSelector(info);items=that.data.elem.find(selector);return items&&items.length>0?items[0]:null};Obj.prototype.getNodeSelector=function(info){return konst.ITEM_SELECTOR+"["+konst.DATA_ATTR_ITEM_ID+'="'+info.sid+'"]'};Obj.prototype.loadOlder=function(){var that=this,lastId=that.getLast();if(!lastId){that.processItems([],"load");return}statik.getList(that.getFilter(),that.getUrl(),that.getNumItems(),function(err,data){that.data.shouldRemoveHtmlItemsAboveLimit=false;if(!err&&data._records){that.processItems(data._records,"load",data._metadata)}else{that.processItems([],"load",data._metadata)}},lastId)};Obj.prototype.start=function(){var that=this,tplEngine=typeof IBTX.thirdParty!=="undefined"?IBTX.thirdParty.Handlebars:IBTX.Handlebars;that.setKonstants();that.setConfiguration();that.data.itemTplCompiled=tplEngine.compile(that.cfg.itemTpl);that.data.renderedOnce=false;that.data.isFetchingData=false;that.data.shouldRemoveHtmlItemsAboveLimit=false;IBTX.jQuery(konst.TOP_CONTAINER_SELECTOR).on("click",konst.LOAD_OLDER_SELECTOR,function(){that.loadOlder()});IBTX.Mod.realtime.whenConnected(function(){that.setTimeout();that.getList()})};Obj.prototype.finish=function(callback){var that=this,channel=konst.CHANNEL_PREFIX+that.socialStreamId;clearTimeout(that.timer);IBTX.Mod.realtime.unsubscribe(channel);that.data.elem.remove();if(callback){callback()}};Obj.prototype.bindHookManager=function(hookMan){var that=this;that.hooks=hookMan};return Obj}(IBTX.jQuery);(function(){"use strict";var localStore={},strFormat=IBTX.Hlp.string.format,$=IBTX.jQuery,typConv=IBTX.Core.Obj.AbstractApp.getConvertedByType;IBTX.App.liveCoverage.on("new",function(lc){lc.setHook("preRender",function(data){if(typConv(lc.cfg["sim-typing"],"boolean")){if(!lc.storeGet(data["item-id"])._meta.isCreate){localStore[data["item-id"]]={futText:data["item-text"]};data["item-text"]=lc.jq.findAll(strFormat("[data-rt-livecoverage-item-id=##]",data["item-id"])).findAll(".rt-livecoverage-item-text").text()}}}).setHook("postRender",function(htmlNode,data){if(typConv(lc.cfg["sim-typing"],"boolean")){if(!lc.storeGet(data["item-id"])._meta.isCreate){IBTX.Mod.typingSim.get(strFormat("{liveId}-{itemId}",{liveId:lc.cfg.id,itemId:data["item-id"]})).start(localStore[data["item-id"]].futText,$(htmlNode).findAll(".rt-livecoverage-item-text"))}}})})})();(function(){"use strict";var strFormat=IBTX.Hlp.string.format,strPadfLeft=IBTX.Hlp.string.padLeft,typConv=IBTX.Core.Obj.AbstractApp.getConvertedByType;function getFormattedDate(d,action){var res;if(d&&d.valueOf()){res=strFormat("{action} at {hour}:{minute}:{second}, on {mon}, {day}, {year}",{action:action,hour:strPadfLeft(d.getHours(),2,"0"),minute:strPadfLeft(d.getMinutes(),2,"0"),second:strPadfLeft(d.getSeconds(),2,"0"),mon:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dez"][d.getMonth()],day:d.getDate(),year:d.getFullYear()})}return res}IBTX.App.liveCoverage.on("new",function(lc){lc.setHook("preRender",function(data){if(typConv(lc.cfg["format-date"],"boolean")){if(data["item-created-at"]){data["item-created-at"]=getFormattedDate(new Date(data["item-created-at"]),"Created");data["item-created-at"]+=typConv(lc.cfg["format-user"],"boolean")?"":". "}if(data["item-updated-at"]){data["item-updated-at"]=getFormattedDate(new Date(data["item-updated-at"]),"Updated");data["item-updated-at"]+=typConv(lc.cfg["format-user"],"boolean")?"":"."}}})})})();(function(){"use strict";var strFormat=IBTX.Hlp.string.format,typConv=IBTX.Core.Obj.AbstractApp.getConvertedByType;IBTX.App.liveCoverage.on("new",function(lc){lc.setHook("preRender",function(data){if(typConv(lc.cfg["format-user"],"boolean")){if(data["item-created-by"]){data["item-created-by"]=strFormat(", by ##. ",data["item-created-by"])}if(data["item-updated-by"]){data["item-updated-by"]=strFormat(", by ##.",data["item-updated-by"])}}})})})();(function(){"use strict";var baseUri=IBTX.Cfg.main.baseUri,ver=IBTX.Cfg.main.ver,apiKey=IBTX.Cfg.main.apiKey;IBTX.jQuery(function(){IBTX.Hlp.load.style(baseUri+"/IBTX/"+apiKey+"/"+ver+"/main.css");IBTX.ready();IBTX.start()})})();